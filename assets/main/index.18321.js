window.__require=function t(e,o,r){function n(a,c){if(!o[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var p="function"==typeof __require&&__require;if(!c&&p)return p(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var u=o[a]={exports:{}};e[a][0].call(u.exports,function(t){return n(e[a][1][t]||t)},u,u.exports,t,e,o,r)}return o[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<r.length;a++)n(r[a]);return n}({BaseUI:[function(t,e,o){"use strict";cc._RF.push(e,"7ee21TmtQdNLo02xs8k9Lm5","BaseUI");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.BaseUI=void 0;var a=cc._decorator,c=a.ccclass,s=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.closeBtn=null,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.node.getComponent(cc.BlockInputEvents)||this.node.addComponent(cc.BlockInputEvents),this.closeBtn&&this.closeBtn.on("click",function(){t.close()})},e.prototype.show=function(t){this.node.active=!0,this.initData(t)},e.prototype.initData=function(){},e.prototype.close=function(){this.node.destroy()},i([s(cc.Node)],e.prototype,"closeBtn",void 0),i([c],e)}(cc.Component);o.BaseUI=p,cc._RF.pop()},{}],BtnExt:[function(t,e,o){"use strict";cc._RF.push(e,"f3b43SQmg5BNLaomE3wSJxl","BtnExt");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.BtnExt=void 0;var a=t("./SoundManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soundEffect="click",e}return n(e,t),e.prototype.onLoad=function(){this.node.getComponent(cc.Button)&&this.node.on("click",this.onClick,this)},e.prototype.onClick=function(){a.SoundManager.playEffect(this.soundEffect)},i([p()],e.prototype,"soundEffect",void 0),i([s],e)}(cc.Component);o.BtnExt=u,cc._RF.pop()},{"./SoundManager":"SoundManager"}],CardBoardData:[function(t,e,o){"use strict";cc._RF.push(e,"af96ccat8RNT46nPJK0895O","CardBoardData"),Object.defineProperty(o,"__esModule",{value:!0}),o.CardBoardData=void 0;var r=t("./CardData"),n=t("../common/GlobalConfigMgr"),i=t("../event/EventBus"),a=t("../kpi/KPIManager"),c=function(){function t(){this.maxLv=1,this.cardMatrix=[],this.cardLvGroup=null,this.groupIdx=0,this.curCardOption=null,this.nextCardOption=null,this.score=0,this.startLv=1,this.finishedCount=0}return t.prototype.getKpiScore=function(){return this.score},t.prototype.addScore=function(t){this.score+=t,i.KpiScoreUpdateEvent.emit(this.score)},t.prototype.getStartLv=function(){return this.startLv},t.prototype.getFinishedCount=function(){return this.finishedCount},t.prototype.addFinishedCount=function(t){this.finishedCount+=t},t.prototype.restoreSnapShot=function(t){for(var e=t.matrix,o=r.GameConfig.matrixSize,n=0,i=e;n<i.length;n++)i[n].length=o;e.length=o,this.cardMatrix=e,this.maxLv=t.maxLv,this.curCardOption=t.curOption,this.nextCardOption=t.nextOption,this.groupIdx=0,this.score=t.kpiScore,this.startLv=t.startLv,this.finishedCount=t.finishedCount,this.decideCardGroup()},t.prototype.resetBoard=function(){for(var t=r.GameConfig.matrixSize,e=0;e<t;e++){var o=[];o.length=t,this.cardMatrix[e]=o}this.maxLv=1,this.groupIdx=0,this.score=0,this.startLv=a.KPIManager.instance.rankLevel,this.decideCardGroup(),this.curCardOption=this.createCardOption(),this.nextCardOption=this.createCardOption()},t.prototype.getSnapshot=function(){return{matrix:this.cardMatrix,maxLv:this.maxLv,curOption:this.curCardOption,nextOption:this.nextCardOption,kpiScore:this.score,startLv:this.startLv,finishedCount:this.finishedCount}},t.prototype.getCardMatrix=function(){return this.cardMatrix},t.prototype.getCurCardOption=function(){return this.curCardOption},t.prototype.getNextCardOption=function(){return this.nextCardOption},t.prototype.generateNextCardOption=function(){this.curCardOption=this.nextCardOption,this.nextCardOption=this.createCardOption()},t.prototype.decideCardGroup=function(){this.cardLvGroup&&this.cardLvGroup.level===this.maxLv||(this.cardLvGroup=n.GlobalConfigMgr.Tables.GDLevelGroup.get(this.maxLv))},t.prototype.getCardData=function(t,e){var o=this.cardMatrix[t];return o?o[e]:(console.error("\u68cb\u76d8\u6570\u636e\u9519\u8bef\uff0cx\u8d85\u51fa\u8303\u56f4"),null)},t.prototype.setCardData=function(t,e,o){var r=this.cardMatrix[e];(!r||r.length<=t)&&console.warn("\u8bbe\u7f6e\u7684\u4f4d\u7f6e\u4e0d\u5408\u6cd5"),r[t]=o},t.prototype.checkMatrixFull=function(){for(var t=0,e=this.cardMatrix;t<e.length;t++)for(var o=0,r=e[t];o<r.length;o++)if(!r[o])return!1;return!0},t.prototype.createCardOption=function(t){void 0===t&&(t=!1);var e=[],o=this.getItemByWeights(this.cardLvGroup.groupWeight),i=n.GlobalConfigMgr.Tables.GDCardsGroup.get(o.key),a=this.getItemByWeights(i.cardCountWeight).key;if(t||1===a){var c=this.createCard(i);e.push(c)}else{var s=this.createCard(i),p=this.createCard(i);s.level===p.level&&(s.isMajorCard=!0),e.push(s,p)}return this.groupIdx++,{cards:e,dir:r.CardDir.TopToBottom}},t.prototype.forceReplaceCurOptionToSingleCard=function(){var t=this.createCardOption(!0);return this.curCardOption=t,t},t.prototype.createCard=function(t){var e=this.getItemByWeights(t.cardIdWeight);return{groupIdx:this.groupIdx,level:e.key,color:this.getCardColor(),isMajorCard:!1}},t.prototype.createCardForLevel=function(t,e){return n.GlobalConfigMgr.Tables.GDCards.get(e)?{groupIdx:t.groupIdx,color:t.color,level:e,isMajorCard:!1}:null},t.prototype.getCardColor=function(){return Math.floor(4*Math.random())},t.prototype.checkLvAboveMax=function(t){return t>this.maxLv&&(this.maxLv=t,this.decideCardGroup(),!0)},t.prototype.getItemByWeights=function(t){for(var e=t.reduce(function(t,e){return t+e.weight},0),o=Math.random()*e,r=0,n=0,i=t;n<i.length;n++){var a=i[n];if(o<(r+=a.weight))return a}return null},t}();o.CardBoardData=c,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../event/EventBus":"EventBus","../kpi/KPIManager":"KPIManager","./CardData":"CardData"}],CardData:[function(t,e,o){"use strict";cc._RF.push(e,"1bcd9oTX/1A97C0q+GNrMLk","CardData"),Object.defineProperty(o,"__esModule",{value:!0}),o.PropType=o.CardDir=o.GameConfig=void 0,o.GameConfig={matrixSize:5,maxLv:7,magColors:[{name:"\u6a58\u8272",color:"#FFA200"},{name:"\u7ea2\u8272",color:"#E8342D"},{name:"\u7eff\u8272",color:"#09A769"},{name:"\u84dd\u8272",color:"#2171E9"}]},function(t){t[t.LeftToRight=0]="LeftToRight",t[t.TopToBottom=1]="TopToBottom",t[t.RightToLeft=2]="RightToLeft",t[t.BottomToTop=3]="BottomToTop"}(o.CardDir||(o.CardDir={})),function(t){t[t.Prompt=0]="Prompt",t[t.Bomb=1]="Bomb",t[t.Exchange=2]="Exchange"}(o.PropType||(o.PropType={})),cc._RF.pop()},{}],CardGroup:[function(t,e,o){"use strict";cc._RF.push(e,"e94b712m9lM3ZbFtAT8w3EW","CardGroup");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.CardGroup=void 0;var a=t("./CardData"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.container=null,e._cardOption=null,e._cards=[],e._offset=5,e}return n(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t){this._cards=t;for(var e=0;e<t.length;e++){var o=t[e];o.node.parent=this.container,o.node.active=!1}},e.prototype.getOptionData=function(){return this._cardOption},e.prototype.getCardJudgeOffset=function(){var t=this._cardOption.dir,e=t===a.CardDir.LeftToRight||t===a.CardDir.RightToLeft,o=this._cardOption.cards.length;return{col:e?o:1,row:e?1:o}},e.prototype.refresh=function(t,e){this._cardOption=t;for(var o=t.cards,r=0;r<o.length;r++){var n=o[r],i=this._cards[r];i.node.active=!0,i.refreshCard(n,!0);var a=cc.Vec3.ZERO;o.length>1&&(a=this.getCardPos(r,t.dir,i.node)),i.node.setPosition(a),i.showCardMask(e)}for(r=o.length;r<this._cards.length;r++)this._cards[r].node.active=!1},e.prototype.getCardPositions=function(){for(var t=[],e=0;e<this._cards.length;e++){var o=this._cards[e];o.node.active&&t.push(o.node.position)}return t},e.prototype.breathEffect=function(t){if(!t)return cc.Tween.stopAllByTarget(this.container),void(this.container.scale=1);cc.Tween.stopAllByTarget(this.container),cc.tween(this.container).repeatForever(cc.tween().to(.5,{scale:.9}).to(.5,{scale:1})).start()},e.prototype.rotateCards=function(){if(this._cardOption.cards.length<=1)return-1;var t=this._cardOption.dir+1;t>a.CardDir.BottomToTop?this._cardOption.dir=t=a.CardDir.LeftToRight:this._cardOption.dir=t;for(var e=0;e<this._cards.length;e++){var o=this._cards[e],r=this.getCardPos(e,t,o.node);cc.Tween.stopAllByTarget(o.node),cc.tween(o.node).to(.1,{position:r},{easing:"sineInOut"}).start()}return t},e.prototype.getCardPos=function(t,e,o){var r=o.width+this._offset,n=o.height+this._offset,i=0,c=0;switch(e){case a.CardDir.BottomToTop:c=t-.5;break;case a.CardDir.LeftToRight:i=t-.5;break;case a.CardDir.RightToLeft:i=.5-t;break;case a.CardDir.TopToBottom:c=.5-t}return cc.v3(i*r,c*n)},i([p(cc.Node)],e.prototype,"container",void 0),i([s],e)}(cc.Component);o.CardGroup=u,cc._RF.pop()},{"./CardData":"CardData"}],CardItem:[function(t,e,o){"use strict";cc._RF.push(e,"87f82nOzeVPD7/n2UjOKTYm","CardItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.CardItem=void 0;var a=t("../common/GlobalConfigMgr"),c=t("../common/SoundManager"),s=cc._decorator,p=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aniNode=null,e.cardLv=null,e.maskNode=null,e.groupTag=null,e.groupTagList=[],e.primaryTag=null,e._cardData=null,e}return n(e,t),e.prototype.refreshCard=function(t,e){void 0===e&&(e=!1),this.aniNode.scale=1,this.aniNode.opacity=255,this._cardData=t,this.primaryTag.active=e&&t.isMajorCard,this.groupTag.spriteFrame=this.groupTagList[t.color];var o=a.GlobalConfigMgr.Tables.GDCards.get(t.level);this.cardLv.string=o.name,this.maskNode.active=!1,this.groupTag.node.active=!e},e.prototype.getCardData=function(){return this._cardData},e.prototype.showCardMask=function(t){this.maskNode.active=t},e.prototype.putToBoardEffect=function(){cc.tween(this.groupTag.node).set({scale:1.5}).to(.3,{scale:1}).call(function(){c.SoundManager.playEffect("put_card")}).start()},e.prototype.showBreathingEffectState=function(t){if(!t)return cc.Tween.stopAllByTarget(this.node),void(this.node.scale=1);cc.tween(this.node).repeatForever(cc.tween(this.node).to(.5,{scale:1.05}).to(.5,{scale:1})).start()},e.prototype.mergeEffect=function(t,e){var o,r=t.length,n=.2/r;if(cc.Tween.stopAllByTarget(this.node),t.length>1){for(var i=[],a=0;a<r;a++){var c=t[a],s=cc.tween(this.node).to(n,{position:c});i.push(s)}(o=cc.tween(this.node)).sequence.apply(o,i).call(e).start()}else cc.tween(this.node).to(n,{position:t[0]}).call(e).start()},e.prototype.levelUpEffect=function(t,e){c.SoundManager.playEffect("card_up"),this.refreshCard(t),this.cardLv.node.scale=0,cc.tween(this.cardLv.node).to(.2,{scale:1}).call(e).start()},e.prototype.levelMaxEffect=function(t){c.SoundManager.playEffect("card_up"),cc.tween(this.aniNode).to(.1,{scale:1.2}).to(.2,{scale:0}).call(t).start()},i([u(cc.Node)],e.prototype,"aniNode",void 0),i([u(cc.Label)],e.prototype,"cardLv",void 0),i([u(cc.Node)],e.prototype,"maskNode",void 0),i([u(cc.Sprite)],e.prototype,"groupTag",void 0),i([u(cc.SpriteFrame)],e.prototype,"groupTagList",void 0),i([u(cc.Node)],e.prototype,"primaryTag",void 0),i([p],e)}(cc.Component);o.CardItem=l,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/SoundManager":"SoundManager"}],CardOptionGenerator:[function(t,e,o){"use strict";cc._RF.push(e,"a9939d2qyROqrxv+SytCRWf","CardOptionGenerator"),Object.defineProperty(o,"__esModule",{value:!0}),o.CardOptionGenerator=void 0;var r=function(){function t(){this.groupConf=null,this.groupDataConf=null}return t.prototype.getCardOption=function(){},t}();o.CardOptionGenerator=r,cc._RF.pop()},{}],EventBus:[function(t,e,o){"use strict";cc._RF.push(e,"1fe466b5jpIPaGF5u0Dc06N","EventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.UsePropEvent=o.ChangePropUseStateEvent=o.ResetGameEvent=o.LevelUpdateEvent=o.TaskUpdateEvent=o.KpiScoreUpdateEvent=void 0;var r=t("../common/TypedEvents");o.KpiScoreUpdateEvent=new r.TEvent,o.TaskUpdateEvent=new r.TEvent,o.LevelUpdateEvent=new r.TEvent,o.ResetGameEvent=new r.TEvent,o.ChangePropUseStateEvent=new r.TEvent,o.UsePropEvent=new r.TEvent,cc._RF.pop()},{"../common/TypedEvents":"TypedEvents"}],FailView:[function(t,e,o){"use strict";cc._RF.push(e,"518475xSxVNAJHyrseLpI/E","FailView");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.FailView=void 0;var a=t("../common/BaseUI"),c=t("../kpi/KPIManager"),s=t("../common/GlobalConfigMgr"),p=t("../common/Utils"),u=t("../event/EventBus"),l=t("../common/SoundManager"),d=cc._decorator,h=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardIcon=null,e.beforeIcon=null,e.afterIcon=null,e.kpiLbl=null,e.kpiScoreLbl=null,e.finishCardLbl=null,e.dateLbl=null,e}return n(e,t),e.prototype.initData=function(e){t.prototype.initData.call(this,e),l.SoundManager.playEffect("fail");var o=e.getStartLv(),r=c.KPIManager.instance.rankLevel,n=e.getKpiScore(),i=e.getFinishedCount(),a=s.GlobalConfigMgr.Tables.GDLevel,u=a.get(r),d=a.get(o);p.Utils.loadSpriteFrame(this.cardIcon,"card-up/cards/k"+u.res),p.Utils.loadSpriteFrame(this.beforeIcon,"card-up/badges/k"+d.res),p.Utils.loadSpriteFrame(this.afterIcon,"card-up/badges/k"+u.res),this.kpiScoreLbl.string="\u5171\u8ba1\u6536\u5165\uff1a\xa5"+n,this.kpiLbl.string="\u5b58\u6b3e\u603b\u989d\uff1a\xa5"+c.KPIManager.instance.kpiScore,this.finishCardLbl.string="\u5b8c\u6210\u4e8b\u9879\uff1a"+i,this.dateLbl.string="\u65e5\u671f\uff1a"+(new Date).toLocaleDateString()},e.prototype.onCloseBtnClick=function(){this.close()},e.prototype.onRestartBtnClick=function(){u.ResetGameEvent.emit(),this.close()},i([f(cc.Sprite)],e.prototype,"cardIcon",void 0),i([f(cc.Sprite)],e.prototype,"beforeIcon",void 0),i([f(cc.Sprite)],e.prototype,"afterIcon",void 0),i([f(cc.Label)],e.prototype,"kpiLbl",void 0),i([f(cc.Label)],e.prototype,"kpiScoreLbl",void 0),i([f(cc.Label)],e.prototype,"finishCardLbl",void 0),i([f(cc.Label)],e.prototype,"dateLbl",void 0),i([h],e)}(a.BaseUI);o.FailView=g,cc._RF.pop()},{"../common/BaseUI":"BaseUI","../common/GlobalConfigMgr":"GlobalConfigMgr","../common/SoundManager":"SoundManager","../common/Utils":"Utils","../event/EventBus":"EventBus","../kpi/KPIManager":"KPIManager"}],GlobalConfigMgr:[function(t,e,o){"use strict";cc._RF.push(e,"40694DbJRVL3oEv98eLbYEz","GlobalConfigMgr");var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,c)}s((r=r.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var o,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GlobalConfigMgr=void 0;var i=t("../data-cfg/type/schema"),a=function(){function t(){}return t.init=function(){return r(this,void 0,void 0,function(){return n(this,function(){return[2,new Promise(function(e,o){cc.resources.loadDir("data/json",cc.JsonAsset,function(r,n){if(r)return console.error(r),void o(r);t.Tables=new i.Tables(function(t){for(var e=0,o=n;e<o.length;e++){var r=o[e];if(r.name===t)return r.json}return null}),e()})})]})})},t.Tables=null,t}();o.GlobalConfigMgr=a,cc._RF.pop()},{"../data-cfg/type/schema":"schema"}],GridItem:[function(t,e,o){"use strict";cc._RF.push(e,"f40411MNrFNJYWfgyBfQKd0","GridItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.GridItem=void 0;var a=t("../event/EventBus"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.debugLbl=null,e.bgNode=null,e._cardItem=null,e._colRowInMatrix=null,e}return n(e,t),e.prototype.init=function(t,e){this.node.name="grid_"+e+"_"+t,this._colRowInMatrix={col:t,row:e},a.ChangePropUseStateEvent.on(this.showBreathingEffectState,this)},e.prototype.getColRow=function(){return this._colRowInMatrix},e.prototype.updateCardItem=function(t){t&&(t.node.name="card_"+this._colRowInMatrix.row+"_"+this._colRowInMatrix.col),this._cardItem=t},e.prototype.getCardItem=function(){return this._cardItem},e.prototype.isHoldCard=function(){return null!=this._cardItem},e.prototype.showBreathingEffectState=function(t){var e;null===(e=this._cardItem)||void 0===e||e.showBreathingEffectState(t)},e.prototype.changeHoverState=function(t){this.bgNode.color=t?cc.Color.GRAY:cc.Color.WHITE},i([p(cc.Label)],e.prototype,"debugLbl",void 0),i([p(cc.Node)],e.prototype,"bgNode",void 0),i([s],e)}(cc.Component);o.GridItem=u,cc._RF.pop()},{"../event/EventBus":"EventBus"}],KPIManager:[function(t,e,o){"use strict";cc._RF.push(e,"c22e3Uf3fZE/aMVNN1RHk7P","KPIManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.KPIManager=o.KpiType=o.KpiState=void 0;var r,n,i=t("../common/LocalCache"),a=t("../common/GlobalConfigMgr"),c=t("../event/EventBus"),s=t("../card-up/CardData"),p=t("../common/UIManager");(function(t){t[t.None=0]="None",t[t.Progress=1]="Progress",t[t.Finish=2]="Finish"})(r=o.KpiState||(o.KpiState={})),function(t){t[t.Score=1]="Score",t[t.Combo=2]="Combo",t[t.MultiMerge=3]="MultiMerge",t[t.MergeLevel=4]="MergeLevel",t[t.MergeCount=5]="MergeCount"}(n=o.KpiType||(o.KpiType={}));var u=function(){function t(){this._gameData=null,this._historyData=null,this._kpiList=[],this._dataDirty=!1}return t.prototype.init=function(){var t=this,e=i.LocalCache.getItem(i.LocalCacheKey.gameData,null);if(e){this._gameData=JSON.parse(e);var o=this._gameData.level;if(this._kpiList=this.getKpiListForLevel(o),this._kpiList)for(var r=0;r<this._gameData.tasks.length;r++){var n=this._gameData.tasks[r];this._kpiList[r].curCount=n.progress}}else this._gameData={props:[0,0,0],tasks:[],level:1,totalKpiScore:0},this._kpiList=this.getKpiListForLevel(1),this._gameData.tasks=this._kpiList.map(function(t){return{id:t.id,progress:0}});this.updateKpiList(),setInterval(function(){t._dataDirty&&(t.saveGameData(),t._dataDirty=!1)},1e3)},Object.defineProperty(t.prototype,"GDKpi",{get:function(){return a.GlobalConfigMgr.Tables.GDKPI},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rankLevel",{get:function(){return this._gameData.level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kpiList",{get:function(){return this._kpiList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kpiScore",{get:function(){return this._gameData.totalKpiScore},enumerable:!1,configurable:!0}),t.prototype.updateKpiList=function(){for(var t=!0,e=0,o=this._kpiList;e<o.length;e++){var n=o[e],i=this.GDKpi.get(n.id);n.curCount>=i.target1?n.state=r.Finish:(n.state=r.Progress,t=!1)}c.TaskUpdateEvent.emit(),t&&(this._gameData.level++,this._kpiList=this.getKpiListForLevel(this._gameData.level),this._dataDirty=!0,p.UIManager.showUI("LevelUpView",{oldLv:this._gameData.level-1,newLv:this._gameData.level}))},t.prototype.saveGameData=function(){this._gameData.tasks=this._kpiList.map(function(t){return{id:t.id,progress:t.curCount}}),i.LocalCache.setItem(i.LocalCacheKey.gameData,JSON.stringify(this._gameData))},t.prototype.getHistoryData=function(){if(!this._historyData){var t=i.LocalCache.getItem(i.LocalCacheKey.historyData,null);this._historyData=t?JSON.parse(t):{historyBestScore:0,todayDate:"",dailyBestScore:0}}return this._historyData},t.prototype.setHistoryData=function(t){var e=this.getHistoryData(),o=(new Date).toLocaleDateString();e.todayDate!==o&&(e.todayDate=o,e.dailyBestScore=0),t>e.historyBestScore&&(e.historyBestScore=t),t>e.dailyBestScore&&(e.dailyBestScore=t),i.LocalCache.setItem(i.LocalCacheKey.historyData,JSON.stringify(e))},t.prototype.getKpiListForLevel=function(t){var e=[],o=a.GlobalConfigMgr.Tables.GDKPI.getDataList().filter(function(e){return e.rank===t});o.sort(function(t,e){return t.id-e.id});for(var n=0,i=o;n<i.length;n++){var c=i[n],s={id:c.id,curCount:0,conf:c,state:r.Progress};e.push(s)}return e},t.prototype.addKpiScore=function(t){this._gameData.totalKpiScore+=t;for(var e=0,o=this._kpiList;e<o.length;e++){var r=o[e];this.GDKpi.get(r.id).targetType===n.Score&&(r.curCount+=t,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiCombo=function(t){for(var e=0,o=this._kpiList;e<o.length;e++){var r=o[e];this.GDKpi.get(r.id).targetType===n.Combo&&(r.curCount+=t,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiMergeLevelCount=function(t,e){for(var o=0,r=this._kpiList;o<r.length;o++){var i=r[o],a=this.GDKpi.get(i.id);a.targetType===n.MergeLevel&&a.target2===t&&(i.curCount+=e,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiMergeColorCount=function(t,e){for(var o=0,r=this._kpiList;o<r.length;o++){var i=r[o],a=this.GDKpi.get(i.id);a.targetType===n.MergeCount&&a.target2===t&&(i.curCount+=e,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiMultiMerge=function(t,e){for(var o=0,r=this._kpiList;o<r.length;o++){var i=r[o],a=this.GDKpi.get(i.id);a.targetType===n.MultiMerge&&a.target2===t&&(i.curCount+=e,this._dataDirty=!0)}this.updateKpiList()},t.prototype.getKpiDesc=function(t){var e=t.conf,o=e.target1,r=e.target2;switch(e.targetType){case n.Score:return"\u83b7\u5f97\u85aa\u8d44<br/>\u3010"+o+"\u3011";case n.Combo:return"\u8fde\u7eed\u5408\u6210<br/>\u3010"+o+"\u3011\u6b21";case n.MergeLevel:return"\u5408\u6210"+a.GlobalConfigMgr.Tables.GDCards.get(r).describe+"<br/>\u3010"+o+"\u3011\u6b21";case n.MergeCount:var i=s.GameConfig.magColors[r];return"\u5408\u6210<color="+i.color+">"+i.name+"</color>\u4e8b\u9879<br/>\u3010"+o+"\u3011\u6b21";case n.MultiMerge:return"\u5355\u6b21\u5408\u6210"+a.GlobalConfigMgr.Tables.GDCards.get(r).describe+"<br/>\u3010"+o+"\u3011\u6b21";default:return""}},t.instance=new t,t}();o.KPIManager=u,cc._RF.pop()},{"../card-up/CardData":"CardData","../common/GlobalConfigMgr":"GlobalConfigMgr","../common/LocalCache":"LocalCache","../common/UIManager":"UIManager","../event/EventBus":"EventBus"}],KpiTaskBoard:[function(t,e,o){"use strict";cc._RF.push(e,"837bakx6fVCZYmhbmu9yeI0","KpiTaskBoard");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.KpiTaskBoard=void 0;var a=t("../event/EventBus"),c=t("./KpiTaskProgressItem"),s=t("./KPIManager"),p=t("../common/Utils"),u=t("../common/GlobalConfigMgr"),l=t("../common/UIManager"),d=cc._decorator,h=d.ccclass,f=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.kpiScoreLbl=null,e.kpiProgressContainers=[],e.kpiProgressItemPrefab=null,e.rankLevelSkeleton=null,e.nextRankLevelNode=null,e.nextRankLevelIcon=null,e.curRankLeveSprite=null,e._kpiProgressItems=[],e._ctx=null,e}return n(e,t),e.prototype.onLoad=function(){s.KPIManager.instance.init();for(var t=0;t<3;t++){var e=cc.instantiate(this.kpiProgressItemPrefab),o=e.getComponent(c.KpiTaskProgressItem);e.parent=this.kpiProgressContainers[t],e.position=cc.Vec3.ZERO,this._kpiProgressItems.push(o)}a.KpiScoreUpdateEvent.on(this.onKpiScoreUpdate,this),a.TaskUpdateEvent.on(this.onKpiTaskUpdate,this),a.LevelUpdateEvent.on(this.onLevelUp,this)},e.prototype.onDestroy=function(){a.KpiScoreUpdateEvent.off(this.onKpiScoreUpdate,this),a.TaskUpdateEvent.off(this.onKpiTaskUpdate,this),a.LevelUpdateEvent.off(this.onLevelUp,this)},e.prototype.initBoard=function(t){this._ctx=t,this.refreshBoard()},e.prototype.refreshBoard=function(){this.initRankLevel(),this.updateKpiTaskList();var t=this._ctx.getKpiScore();this.onKpiScoreUpdate(t)},e.prototype.initRankLevel=function(){var t=u.GlobalConfigMgr.Tables.GDLevel,e=s.KPIManager.instance.rankLevel,o=t.get(e);if(o){p.Utils.loadSpriteFrame(this.curRankLeveSprite,"card-up/badges/k"+o.res);var r=e+1,n=t.get(r);n?(this.nextRankLevelNode.active=!0,p.Utils.loadSpriteFrame(this.nextRankLevelIcon,"card-up/cards/k"+n.res)):this.nextRankLevelNode.active=!1}},e.prototype.onLevelUp=function(){for(var t=this,e=0;e<this._kpiProgressItems.length;e++)this._kpiProgressItems[e].onLevelUpEffect(.3,.5);var o=this.nextRankLevelIcon.node;cc.tween(o).to(.3,{y:200},{easing:"quadIn"}).call(function(){t.initRankLevel(),t.updateKpiTaskList()}).to(.5,{y:0},{easing:"quadIn"}).start()},e.prototype.updateKpiTaskList=function(){for(var t=s.KPIManager.instance.kpiList,e=0;e<this._kpiProgressItems.length;e++){var o=this._kpiProgressItems[e];if(e<t.length){var r=t[e];o.init(r)}else o.node.active=!1}},e.prototype.onKpiScoreUpdate=function(t){this.kpiScoreLbl.string="\xa5"+t,cc.tween(this.kpiScoreLbl.node).to(.2,{scale:1.2},{easing:"sineInOut"}).to(.1,{scale:1},{easing:"sineInOut"}).start()},e.prototype.onKpiTaskUpdate=function(){for(var t=0;t<this._kpiProgressItems.length;t++)this._kpiProgressItems[t].refresh()},e.prototype.onClickBoard=function(){l.UIManager.showUI("KpiTaskView",null)},e.prototype.onClickSettings=function(){l.UIManager.showUI("SettingsView",null)},i([f(cc.Label)],e.prototype,"kpiScoreLbl",void 0),i([f(cc.Node)],e.prototype,"kpiProgressContainers",void 0),i([f(cc.Prefab)],e.prototype,"kpiProgressItemPrefab",void 0),i([f(sp.Skeleton)],e.prototype,"rankLevelSkeleton",void 0),i([f(cc.Node)],e.prototype,"nextRankLevelNode",void 0),i([f(cc.Sprite)],e.prototype,"nextRankLevelIcon",void 0),i([f(cc.Sprite)],e.prototype,"curRankLeveSprite",void 0),i([h],e)}(cc.Component);o.KpiTaskBoard=g,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/UIManager":"UIManager","../common/Utils":"Utils","../event/EventBus":"EventBus","./KPIManager":"KPIManager","./KpiTaskProgressItem":"KpiTaskProgressItem"}],KpiTaskItem:[function(t,e,o){"use strict";cc._RF.push(e,"230b0/yATtNm7pnJecLP2UA","KpiTaskItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.KpiTaskItem=void 0;var a=t("./KPIManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.descTxt=null,e.processNode=null,e.processLabel=null,e.finishNode=null,e}return n(e,t),e.prototype.refresh=function(t){var e=a.KPIManager.instance.getKpiDesc(t);this.descTxt.string=e;var o=t.state===a.KpiState.Finish;this.processNode.active=!o,this.finishNode.active=o,o||(this.processLabel.string=t.curCount+"/"+t.conf.target1)},i([p(cc.RichText)],e.prototype,"descTxt",void 0),i([p(cc.Node)],e.prototype,"processNode",void 0),i([p(cc.Label)],e.prototype,"processLabel",void 0),i([p(cc.Node)],e.prototype,"finishNode",void 0),i([s],e)}(cc.Component);o.KpiTaskItem=u,cc._RF.pop()},{"./KPIManager":"KPIManager"}],KpiTaskProgressItem:[function(t,e,o){"use strict";cc._RF.push(e,"a17e9uu9d1Jbpnhk6hTHwmt","KpiTaskProgressItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.KpiTaskProgressItem=void 0;var a=t("./KPIManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.processNode=null,e.progressBar=null,e.finishNode=null,e._taskData=null,e.progressBarMaxWidth=92,e}return n(e,t),e.prototype.init=function(t){this._taskData=t,this.refresh()},e.prototype.refresh=function(){var t=this._taskData.state===a.KpiState.Finish;if(this.processNode.active=!t,this.finishNode.active=t,!t){var e=this._taskData.curCount/this._taskData.conf.target1;this.progressBar.node.width=Math.min(e,1)*this.progressBarMaxWidth}},e.prototype.onLevelUpEffect=function(t,e){cc.tween(this.node).to(t,{opacity:0}).to(e,{opacity:255}).start()},i([p(cc.Node)],e.prototype,"processNode",void 0),i([p(cc.Sprite)],e.prototype,"progressBar",void 0),i([p(cc.Node)],e.prototype,"finishNode",void 0),i([s],e)}(cc.Component);o.KpiTaskProgressItem=u,cc._RF.pop()},{"./KPIManager":"KPIManager"}],KpiTaskView:[function(t,e,o){"use strict";cc._RF.push(e,"964c6xO7EBFA6T5wlwS2KKH","KpiTaskView");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.KpiTaskView=void 0;var a=t("../common/BaseUI"),c=t("./KpiTaskItem"),s=t("./KPIManager"),p=cc._decorator,u=p.ccclass,l=p.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.taskContainers=[],e.taskItemPrefab=null,e.taskItems=[],e}return n(e,t),e.prototype.initData=function(e){t.prototype.initData.call(this,e);for(var o=s.KPIManager.instance.kpiList,r=0;r<this.taskContainers.length;r++){var n=this.taskContainers[r],i=cc.instantiate(this.taskItemPrefab),a=i.getComponent(c.KpiTaskItem);i.parent=n,i.position=cc.Vec3.ZERO,this.taskItems.push(a),r<o.length&&a.refresh(o[r])}},e.prototype.onCloseBtnClick=function(){this.close()},i([l(cc.Node)],e.prototype,"taskContainers",void 0),i([l(cc.Prefab)],e.prototype,"taskItemPrefab",void 0),i([u],e)}(a.BaseUI);o.KpiTaskView=d,cc._RF.pop()},{"../common/BaseUI":"BaseUI","./KPIManager":"KPIManager","./KpiTaskItem":"KpiTaskItem"}],LevelUpView:[function(t,e,o){"use strict";cc._RF.push(e,"92b80bRmWJFy6b4j8mDinlo","LevelUpView");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.LevelUpView=void 0;var a=t("../common/BaseUI"),c=t("../common/GlobalConfigMgr"),s=t("../common/Utils"),p=t("../event/EventBus"),u=t("../common/SoundManager"),l=cc._decorator,d=l.ccclass,h=l.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.oldLvIcon=null,e.newLvIcon=null,e}return n(e,t),e.prototype.initData=function(e){var o=this;t.prototype.initData.call(this,e),u.SoundManager.playEffect("rank_up");var r=c.GlobalConfigMgr.Tables.GDLevel,n=r.get(e.oldLv),i=r.get(e.newLv);s.Utils.loadSpriteFrame(this.oldLvIcon,"card-up/cards/k"+n.res),s.Utils.loadSpriteFrame(this.newLvIcon,"card-up/cards/k"+i.res),this.scheduleOnce(function(){o.close(),p.LevelUpdateEvent.emit(e.newLv)},2)},i([h(cc.Sprite)],e.prototype,"oldLvIcon",void 0),i([h(cc.Sprite)],e.prototype,"newLvIcon",void 0),i([d],e)}(a.BaseUI);o.LevelUpView=f,cc._RF.pop()},{"../common/BaseUI":"BaseUI","../common/GlobalConfigMgr":"GlobalConfigMgr","../common/SoundManager":"SoundManager","../common/Utils":"Utils","../event/EventBus":"EventBus"}],LoadingScene:[function(t,e,o){"use strict";cc._RF.push(e,"0d2d1eZx3tOgYB5mvHaqLX8","LoadingScene");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,c)}s((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.LoadingScene=void 0;var s=t("../common/GlobalConfigMgr"),p=t("../common/SoundManager"),u=cc._decorator,l=u.ccclass,d=u.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.progressNode=null,e.progressLbl=null,e.progressFill=null,e.startBtn=null,e}return n(e,t),e.prototype.onLoad=function(){this.startLoading()},e.prototype.startLoading=function(){return a(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return this.startBtn.active=!1,this.progressLbl.string="\u52a0\u8f7d\u4e2d...",this.progressFill.width=0,[4,this.preloadConfig()];case 1:return t.sent(),this.progressFill.width=.2*this.progressNode.width,[4,this.preloadAssets()];case 2:return t.sent(),this.progressNode.active=!1,this.startBtn.active=!0,p.SoundManager.init(),[2]}})})},e.prototype.preloadAssets=function(){return a(this,void 0,void 0,function(){var t=this;return c(this,function(){return[2,new Promise(function(e){cc.director.preloadScene("main",function(e,o){t.progressLbl.string=Math.floor(e/o*100)+"%",t.progressFill.width=t.progressNode.width*(.2+e/o*.8)},function(){e()})})]})})},e.prototype.preloadConfig=function(){return s.GlobalConfigMgr.init()},e.prototype.onStartBtnClick=function(){cc.director.loadScene("main")},i([d(cc.Node)],e.prototype,"progressNode",void 0),i([d(cc.Label)],e.prototype,"progressLbl",void 0),i([d(cc.Node)],e.prototype,"progressFill",void 0),i([d(cc.Node)],e.prototype,"startBtn",void 0),i([l],e)}(cc.Component);o.LoadingScene=h,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/SoundManager":"SoundManager"}],LocalCache:[function(t,e,o){"use strict";cc._RF.push(e,"3b692DIl0FHrJ9jkywJDuFy","LocalCache"),Object.defineProperty(o,"__esModule",{value:!0}),o.LocalCache=o.LocalCacheKey=void 0,o.LocalCacheKey={snapshot:"snapshot",gameData:"gameData",historyData:"historyData",bgmMute:"bgmMute",sfxMute:"sfxMute",vibrationMute:"vibrationMute"};var r=function(){function t(){}return t.getItem=function(t,e){var o=cc.sys.localStorage.getItem(t);return null!=o?o:e},t.setItem=function(t,e){cc.sys.localStorage.setItem(t,e)},t.removeItem=function(t){cc.sys.localStorage.removeItem(t)},t.clear=function(){cc.sys.localStorage.clear()},t}();o.LocalCache=r,cc._RF.pop()},{}],MergeBoard:[function(t,e,o){"use strict";cc._RF.push(e,"db8beK2X1REZqTbAIBKz1j0","MergeBoard");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,c)}s((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MergeBoard=void 0;var s=t("./CardItem"),p=t("./CardBoardData"),u=t("./CardData"),l=t("../common/LocalCache"),d=t("./CardGroup"),h=t("./GridItem"),f=t("./MergeEffectToast"),g=t("../common/GlobalConfigMgr"),v=t("../common/SoundManager"),y=t("../kpi/KPIManager"),_=t("../event/EventBus"),C=t("../prop/PropTicket"),m=t("../kpi/KpiTaskBoard"),b=t("../common/UIManager"),M=cc.js.isNumber,P=cc._decorator,w=P.ccclass,O=P.property,L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.toastContainer=null,e.toastPrefab=null,e.gridContainer=null,e.gridPrefab=null,e.curCardsContainer=null,e.touchRect=null,e.rotationArrow=null,e.nextCardsContainer=null,e.cardGroupPrefab=null,e.propBackContainer=null,e.propItem=null,e.cardPrefab=null,e.kpiTaskBoard=null,e.cardWidth=125,e.cardHeight=130,e.cardSpace=5,e._gridMatrix=[],e._curOption=null,e._nextOption=null,e._boardData=null,e._mergeResult=null,e._handleMergeGrids=[],e._cardPool=new cc.NodePool,e._toastBlockState=!1,e._touchStartPos=null,e._gridStartPos=null,e._optionStartPos=null,e._cardGridOffset=null,e._cardRelativePosList=[],e._cardCachePosList=[],e._hoveringGrids=[],e._curPosInMatrix=null,e._isTouching=!1,e._touchStartTime=0,e._draggingTimeThreshold=300,e._draggingDistanceThreshold=10,e._isUsingProp=!1,e._propType=null,e._hoverGrid=null,e.toastCount=0,e.centerOffset=(u.GameConfig.matrixSize-1)/2,e}return n(e,t),e.prototype.onLoad=function(){v.SoundManager.playMusic("bgm"),this.createGrids(),this.loadBoard(),this.resetBoard(),this.touchRect.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touchRect.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touchRect.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchRect.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),_.ResetGameEvent.on(this.onResetGameClick,this),_.UsePropEvent.on(this.onUsePropClick,this),_.ChangePropUseStateEvent.on(this.onPropUseFinish,this),this.kpiTaskBoard.initBoard(this)},e.prototype.onDestroy=function(){this.touchRect.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touchRect.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touchRect.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchRect.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),_.ResetGameEvent.off(this.onResetGameClick,this),_.UsePropEvent.off(this.onUsePropClick,this),_.ChangePropUseStateEvent.off(this.onPropUseFinish,this)},e.prototype.onResetGameClick=function(){this._boardData=new p.CardBoardData,this._boardData.resetBoard(),this.kpiTaskBoard.refreshBoard(),this.saveSnapshot(),this.resetBoard()},e.prototype.onUsePropClick=function(t){this._propType=t,this.propItem.refresh(t)},e.prototype.onPropUseFinish=function(t){this._isUsingProp=t,this.propItem.node.position=cc.Vec3.ZERO,this.propBackContainer.active=t,this.curCardsContainer.active=!t},e.prototype.onTouchStart=function(t){if(!this._toastBlockState&&!this._isTouching){var e=this._touchStartPos=t.getLocation();if(this._isUsingProp){var o=this.propBackContainer.convertToNodeSpaceAR(e);this.propItem.node.getBoundingBox().contains(o)&&(this._isTouching=!0)}else this.judgeTouchCurOption(e)&&(this._gridStartPos=this.gridContainer.convertToNodeSpaceAR(e),this._optionStartPos=this.curCardsContainer.convertToNodeSpaceAR(e),this._curOption.breathEffect(!1),this._isTouching=!0,this._touchStartTime=Date.now(),this._curPosInMatrix=cc.v3(this._gridStartPos.x,this._gridStartPos.y),this._cardRelativePosList=this._curOption.getCardPositions(),this._cardCachePosList=this._cardRelativePosList.map(function(t){return t.clone()}),this._cardGridOffset=this._curOption.getCardJudgeOffset())}},e.prototype.onTouchMove=function(t){var e,o,r,n,i;if(this._isTouching)if(this._isUsingProp){var a=t.getLocation(),c=this.propBackContainer.convertToNodeSpaceAR(a);this.propItem.node.position=cc.v3(c.x,c.y);var s=this.findCardContainsPoint(a);if(this._propType===u.PropType.Prompt)this._hoverGrid!==s&&(null===(o=null===(e=this._hoverGrid)||void 0===e?void 0:e.getCardItem())||void 0===o||o.showCardMask(!1)),this._hoverGrid=s,s&&(null===(r=this._hoverGrid.getCardItem())||void 0===r||r.showCardMask(!0));else{this._hoverGrid=s;var p=null===(i=null===(n=null==s?void 0:s.getCardItem())||void 0===n?void 0:n.getCardData())||void 0===i?void 0:i.color;this.updateHoverColor(M(p)?p:-1)}}else{var l=t.getLocation().sub(this._touchStartPos);if(l.mag()<this._draggingDistanceThreshold)return;this._curOption.node.x=this._optionStartPos.x+l.x,this._curOption.node.y=this._optionStartPos.y+l.y,this.updateTouchPosInMatrix(l),this.rotationArrow.active=!1,this.updateHoverGrids()}},e.prototype.onTouchEnd=function(t){var e=this;if(this._isTouching){if(this._isUsingProp)if(this._hoverGrid&&this._hoverGrid.getCardItem()){if(this._propType==u.PropType.Prompt){var o=this._hoverGrid.getCardItem(),r=o.getCardData(),n=this._boardData.createCardForLevel(r,r.level+1);if(n){n.isMajorCard=!0;var i=this._hoverGrid.getColRow();this._boardData.setCardData(i.col,i.row,n),this._handleMergeGrids.push(this._hoverGrid),this._mergeResult={operations:[],score:0},o.levelUpEffect(n,function(){var t=n.level,o=function(){e.handleMergeCard()};if(e._boardData.checkLvAboveMax(t)){var r=g.GlobalConfigMgr.Tables.GDCards.get(t);e.showToast(f.MergeEffectType.CardUp,"\u606d\u559c\u83b7\u53d6"+r.name+"\u7ea7\u4e8b\u9879\uff01",o)}else o()})}else o.levelMaxEffect(function(){e._cardPool.put(o.node),e._hoverGrid.updateCardItem(null);var t=e._hoverGrid.getColRow();e._boardData.setCardData(t.col,t.row,null),e.showToast(f.MergeEffectType.CardMax,"\u5b8c\u6210\u4e8b\u9879\uff01",null),e.saveSnapshot()});v.SoundManager.playEffect("prop_card_up")}else if(this._propType===u.PropType.Bomb){for(var a=this._hoverGrid.getCardItem().getCardData().color,c=[],s=0,p=this._gridMatrix;s<p.length;s++)for(var l=0,d=p[s];l<d.length;l++){var h=(b=d[l]).getCardItem();h&&h.getCardData().color===a&&c.push(b)}for(var y=function(t){var o=t.getCardItem();o.levelMaxEffect(function(){e._cardPool.put(o.node),t.updateCardItem(null);var r=t.getColRow();e._boardData.setCardData(r.col,r.row,null)})},C=0,m=c;C<m.length;C++){var b;y(b=m[C])}this.saveSnapshot(),this._hoverGrid=null,v.SoundManager.playEffect("prop_bomb")}this.propItem.node.position=cc.Vec3.ZERO,_.ChangePropUseStateEvent.emit(!1)}else v.SoundManager.playEffect("wrong"),cc.tween(this.propItem.node).to(.2,{position:cc.Vec3.ZERO}).start(),this.updateHoverColor(-1);else{var M=t.getLocation().sub(this._touchStartPos),P=M.mag(),w=Date.now()-this._touchStartTime<this._draggingTimeThreshold,O=P<this._draggingDistanceThreshold;w&&O?(v.SoundManager.playEffect("option_rotate"),this.onTouchOption(),this._curOption.breathEffect(!0)):(this.updateTouchPosInMatrix(M),this.fillHoverGrids(),this.judgeCanPutCards()?(this.putCardsToGrids(),this.resetCurCardOption(!1)):(v.SoundManager.playEffect("wrong"),this.resetCurCardOption()),this.refreshHoverGrids(null)),this.rotationArrow.active=!0}this._isTouching=!1}},e.prototype.updateHoverColor=function(t){for(var e=0,o=this._gridMatrix;e<o.length;e++)for(var r=0,n=o[e];r<n.length;r++){var i=n[r].getCardItem();i&&i.showCardMask(i.getCardData().color===t)}},e.prototype.putCardsToGrids=function(){var t=this._hoveringGrids,e=this._curOption.getOptionData(),o=e.cards;(e.dir===u.CardDir.BottomToTop||e.dir===u.CardDir.RightToLeft)&&(o=o.reverse());for(var r=t.slice(),n=0;n<o.length;n++){var i=o[n],a=t[n],c=this.getCardItem();c.node.active=!0,c.node.setParent(this.gridContainer),c.node.position=a.node.position,c.refreshCard(i),c.putToBoardEffect(),a.updateCardItem(c);var s=a.getColRow();this._boardData.setCardData(s.col,s.row,i)}r.length>1&&r.sort(function(t,e){var o=t.getCardItem().getCardData(),r=e.getCardItem().getCardData();return o.level===r.level?o.isMajorCard?-1:1:o.level-r.level}),this._handleMergeGrids=r,this._mergeResult={operations:[],score:0},this.handleMergeCard(),this.produceOption()},e.prototype.handleMergeCard=function(){var t=this;if(console.log("\u5f00\u59cb\u5408\u6210\u5361\u7247",this._handleMergeGrids),0!==this._handleMergeGrids.length){var e=this._handleMergeGrids.shift();if(e&&e.getCardItem()){var o={parent:null,grid:e,depth:0},r={level:e.getCardItem().getCardData().level,mergeDataList:[o]};this._mergeResult.operations.push(r),this.collectMergeOperationInfoRecursively(r,[e],[o]).then(function(){console.log("\u672c\u6b21\u6536\u96c6\u5230\u7684\u7ed3\u679c\uff1a",r),r&&r.mergeDataList.length>=3?t.onExecuteMergeOperation(r,function(){t.handleMergeCard()}):t.handleMergeCard()})}else this.handleMergeCard()}else this.onHandleMergeFinish()},e.prototype.collectMergeOperationInfoRecursively=function(t,e,o){return a(this,void 0,void 0,function(){var r,n,i,a,s,p,u,l;return c(this,function(c){switch(c.label){case 0:if(0===o.length)return[2];for(r=t.level,n=[],i=0;i<o.length;i++)for(a=o[i],s=this.findCanMergeNeighbors(a,r),p=0;p<s.length;p++)u=s[p],e.includes(u)||(l={grid:u,parent:a,depth:a.depth+1},t.mergeDataList.push(l),n.push(l),e.push(u));return[4,this.collectMergeOperationInfoRecursively(t,e,n)];case 1:return c.sent(),[2]}})})},e.prototype.onExecuteMergeOperation=function(t,e){for(var o=this,r=t.mergeDataList,n=function(n){var a=r[n],c=a.grid.getColRow();if(!a.grid.getCardItem())return"continue";if(a.parent){console.log("\u5408\u6210\u679d\u5e72\u64cd\u4f5c, \u5f53\u524d\u5c42\u7ea7: "+a.depth+", \u5f53\u524d\u683c\u5b50: "+c.col+", "+c.row);var s=a.grid;if(s){var p=s.getCardItem();if(p){for(var u=[],l=a.parent;null!==l;)u.push(l.grid.node.position),l=l.parent;p.mergeEffect(u,function(){o._cardPool.put(p.node),s.updateCardItem(null);var t=s.getColRow();o._boardData.setCardData(t.col,t.row,null)})}}}else{console.log("\u5408\u6210\u6839\u8282\u70b9\u64cd\u4f5c, \u5f53\u524d\u683c\u5b50: "+c.col+", "+c.row);var d=t.level,h=r.length,v=g.GlobalConfigMgr.Tables.GDMergeResult.getDataList().find(function(t){return t.cId===d&&t.cardCount===h}),_=v.scoreRate*v.cId_ref.money*h;i._boardData.addScore(_),i._boardData.addFinishedCount(h),y.KPIManager.instance.addKpiScore(_);for(var C={},m=0;m<r.length;m++){var b=r[m].grid.getCardItem();if(b){var M=b.getCardData();C[M.color]||(C[M.color]=0),C[M.color]++}}for(var P in C){var w=C[P];w>1&&y.KPIManager.instance.addKpiMergeColorCount(parseInt(P),w)}y.KPIManager.instance.addKpiMergeLevelCount(d,h),y.KPIManager.instance.addKpiMultiMerge(d,h);var O=a.grid.getCardItem(),L=O.getCardData(),I=i._boardData.createCardForLevel(L,L.level+1);I?(I.isMajorCard=!0,i._boardData.setCardData(c.col,c.row,I),i._handleMergeGrids.unshift(a.grid),O.levelUpEffect(I,function(){var t=I.level,r=function(){h>3?o.showToast(f.MergeEffectType.MergeCount,v.describe+"x"+h,e):e()};if(o._boardData.checkLvAboveMax(t)){var n=g.GlobalConfigMgr.Tables.GDCards.get(t);o.showToast(f.MergeEffectType.CardUp,"\u606d\u559c\u83b7\u53d6"+n.name+"\u7ea7\u4e8b\u9879\uff01",r)}else r()})):O.levelMaxEffect(function(){o._cardPool.put(O.node),a.grid.updateCardItem(null);var t=a.grid.getColRow();o._boardData.setCardData(t.col,t.row,null),o.showToast(f.MergeEffectType.CardMax,"\u5b8c\u6210\u4e8b\u9879\uff01",e)})}},i=this,a=r.length-1;a>=0;a--)n(a)},e.prototype.showToast=function(t,e,o){var r=this;void 0===o&&(o=null),v.SoundManager.playEffect("toast");var n=cc.instantiate(this.toastPrefab);this.toastContainer.addChild(n);var i=n.getComponent(f.MergeEffectToast);this.toastCount++,i.showToast(t,e,function(){r.toastCount--,r.toastCount<=0&&(r._toastBlockState=!1),o&&o()})},e.prototype.checkFull=function(){var t=this._boardData.checkMatrixFull();return t&&this.onBoardFull(),t},e.prototype.onHandleMergeFinish=function(){if(!this.checkFull()){for(var t=0,e=0;e<this._mergeResult.operations.length;e++)this._mergeResult.operations[e].mergeDataList.length>=3&&t++;t>=2&&(this.showToast(f.MergeEffectType.Combo,"\u8fde\u7eed\u5b8c\u6210\u4e8b\u9879x"+t),y.KPIManager.instance.addKpiCombo(t)),this.saveSnapshot()}},e.prototype.saveSnapshot=function(){var t=this._boardData.getSnapshot();l.LocalCache.setItem(l.LocalCacheKey.snapshot,JSON.stringify(t))},e.prototype.onBoardFull=function(){b.UIManager.showUI("FailView",this._boardData)},e.prototype.findCanMergeNeighbors=function(t,e){var o=this,r=t.grid.getColRow(),n=[],i=function(t,r){var i=o.getGridItemByColRow(t,r);i&&i.getCardItem()&&i.getCardItem().getCardData().level===e&&n.push(i)};return i(r.col-1,r.row),i(r.col+1,r.row),i(r.col,r.row-1),i(r.col,r.row+1),n},e.prototype.findCardContainsPoint=function(t){for(var e=this.gridContainer.convertToNodeSpaceAR(t),o=this.getGridColRow(e.x,e.y),r=o.row,n=o.col,i=r-1;i<=r+1;i++)for(var a=n-1;a<=n+1;a++){var c=this.getGridItemByColRow(a,i);if(c){var s=c.getCardItem();if(s&&s.node.getBoundingBoxToWorld().contains(t))return c}}return null},e.prototype.getGridItemByColRow=function(t,e){var o=this._gridMatrix;if(e<0||e>=o.length)return null;var r=o[e];return t<0||t>=r.length?null:r[t]},e.prototype.updateTouchPosInMatrix=function(t){this._curPosInMatrix.x=this._gridStartPos.x+t.x,this._curPosInMatrix.y=this._gridStartPos.y+t.y;for(var e=0;e<this._cardRelativePosList.length;e++){var o=this._cardRelativePosList[e];this._cardCachePosList[e].x=this._curPosInMatrix.x+o.x,this._cardCachePosList[e].y=this._curPosInMatrix.y+o.y}},e.prototype.judgeTouchCurOption=function(t){return this._curOption.node.getBoundingBoxToWorld().contains(t)},e.prototype.fillHoverGrids=function(){var t=this.getHoverGrids();this.refreshHoverGrids(t),this._hoveringGrids=t},e.prototype.refreshHoverGrids=function(t){if(this._hoveringGrids)for(var e=0;e<this._hoveringGrids.length;e++){var o=this._hoveringGrids[e];t&&t.includes(o)||o.changeHoverState(!1)}if(t)for(e=0;e<t.length;e++)o=t[e],this._hoveringGrids.includes(o)||o.changeHoverState(!0)},e.prototype.judgeCanPutCards=function(){return this._hoveringGrids.length===this._cardRelativePosList.length},e.prototype.getHoverGrids=function(){for(var t=this._curPosInMatrix,e=this.getGridColRow(t.x,t.y),o=e.row,r=e.col,n=u.GameConfig.matrixSize,i=this._cardGridOffset.col,a=this._cardGridOffset.row,c=Math.max(o-a,0),s=Math.min(o+a,n),p=Math.max(r-i,0),l=Math.min(r+i,n),d=[],h=c;h<s;h++)for(var f=p;f<l;f++){var g=this._gridMatrix[h][f];g.isHoldCard()||this.judgeGridInCardOption(g)&&d.push(g)}return d},e.prototype.judgeGridInCardOption=function(t){for(var e=this.cardWidth/2,o=this.cardHeight/2,r=t.node.position,n=0;n<this._cardCachePosList.length;n++){var i=this._cardCachePosList[n],a=i.x>=r.x-e&&i.x<=r.x+e,c=i.y>=r.y-o&&i.y<=r.y+o;if(a&&c)return!0}return!1},e.prototype.updateHoverGrids=function(){this.fillHoverGrids()},e.prototype.onTouchOption=function(){var t=this._curOption.rotateCards();-1!==t&&cc.tween(this.rotationArrow).by(.2,{angle:-90}).set({angle:-90*t}).start()},e.prototype.resetCurCardOption=function(t){var e=this;void 0===t&&(t=!0),t?cc.tween(this._curOption.node).to(.2,{position:cc.Vec3.ZERO}).call(function(){e._curOption.breathEffect(!0)}).start():(this._curOption.node.position=cc.Vec3.ZERO,this._curOption.breathEffect(!0))},e.prototype.produceOption=function(){this._boardData.generateNextCardOption();var t=this._boardData.getCurCardOption();t.cards.length>1&&(this.checkCurOptionCanPut()||(t=this._boardData.forceReplaceCurOptionToSingleCard())),this._curOption.refresh(t,!1);var e=this._boardData.getNextCardOption();this._nextOption.refresh(e,!0),this._curOption.breathEffect(!0),this.rotationArrow.angle=90},e.prototype.checkCurOptionCanPut=function(){for(var t=this._gridMatrix,e=0;e<t.length;e++)for(var o=t[e],r=0;r<o.length;r++)if(!o[r].isHoldCard()){var n=r+1;if(n<o.length&&!o[n].isHoldCard())return!0;var i=e+1;if(i<t.length&&!t[i][r].isHoldCard())return!0}return!1},e.prototype.createGrids=function(){for(var t=u.GameConfig.matrixSize,e=0;e<t;e++){var o=[];this._gridMatrix.push(o);for(var r=0;r<t;r++){var n=cc.instantiate(this.gridPrefab);this.gridContainer.addChild(n);var i=this.getCardPos(e,r);n.setPosition(i);var a=n.getComponent(h.GridItem);a.init(r,e),o.push(a)}}},e.prototype.loadBoard=function(){var t=this._boardData=new p.CardBoardData,e=l.LocalCache.getItem(l.LocalCacheKey.snapshot,null);if(e){var o=JSON.parse(e);t.restoreSnapShot(o)}else t.resetBoard()},e.prototype.resetBoard=function(){this.onPropUseFinish(!1);for(var t=this._boardData.getCardMatrix(),e=this._gridMatrix,o=0;o<e.length;o++)for(var r=e[o],n=t[o],i=0;i<r.length;i++){var a=r[i],c=null==n?void 0:n[i],s=a.getCardItem();c?(s||((s=this.getCardItem()).node.parent=this.gridContainer),s.node.position=a.node.position,s.refreshCard(c),a.updateCardItem(s)):(s&&this._cardPool.put(s.node),a.updateCardItem(null))}this._curOption||(this._curOption=this.createCardOption(),this.curCardsContainer.addChild(this._curOption.node),this._curOption.refresh(this._boardData.getCurCardOption(),!1),this._curOption.breathEffect(!0)),this._nextOption||(this._nextOption=this.createCardOption(),this.nextCardsContainer.addChild(this._nextOption.node),this._nextOption.refresh(this._boardData.getNextCardOption(),!0)),this.checkFull()},e.prototype.createCardOption=function(){var t=cc.instantiate(this.cardGroupPrefab).getComponent(d.CardGroup);return t.init([this.getCardItem(),this.getCardItem()]),t},e.prototype.getCardItem=function(){var t;return(t=this._cardPool.size()>0?this._cardPool.get():cc.instantiate(this.cardPrefab)).scale=1,t.active=!0,t.opacity=255,t.stopAllActions(),t.getComponent(s.CardItem)},e.prototype.getCardPos=function(t,e){var o=(e-this.centerOffset)*(this.cardWidth+this.cardSpace),r=(this.centerOffset-t)*(this.cardHeight+this.cardSpace);return cc.v3(o,r)},e.prototype.getGridColRow=function(t,e){var o=Math.round(t/(this.cardWidth+this.cardSpace)+this.centerOffset);return{row:Math.round(this.centerOffset-e/(this.cardHeight+this.cardSpace)),col:o}},e.prototype.getKpiScore=function(){return this._boardData.getKpiScore()},i([O(cc.Node)],e.prototype,"toastContainer",void 0),i([O(cc.Prefab)],e.prototype,"toastPrefab",void 0),i([O(cc.Node)],e.prototype,"gridContainer",void 0),i([O(cc.Prefab)],e.prototype,"gridPrefab",void 0),i([O(cc.Node)],e.prototype,"curCardsContainer",void 0),i([O(cc.Node)],e.prototype,"touchRect",void 0),i([O(cc.Node)],e.prototype,"rotationArrow",void 0),i([O(cc.Node)],e.prototype,"nextCardsContainer",void 0),i([O(cc.Prefab)],e.prototype,"cardGroupPrefab",void 0),i([O(cc.Node)],e.prototype,"propBackContainer",void 0),i([O(C.PropTicket)],e.prototype,"propItem",void 0),i([O(cc.Prefab)],e.prototype,"cardPrefab",void 0),i([O(m.KpiTaskBoard)],e.prototype,"kpiTaskBoard",void 0),i([w],e)}(cc.Component);o.MergeBoard=L,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/LocalCache":"LocalCache","../common/SoundManager":"SoundManager","../common/UIManager":"UIManager","../event/EventBus":"EventBus","../kpi/KPIManager":"KPIManager","../kpi/KpiTaskBoard":"KpiTaskBoard","../prop/PropTicket":"PropTicket","./CardBoardData":"CardBoardData","./CardData":"CardData","./CardGroup":"CardGroup","./CardItem":"CardItem","./GridItem":"GridItem","./MergeEffectToast":"MergeEffectToast"}],MergeEffectToast:[function(t,e,o){"use strict";cc._RF.push(e,"aa4a3WfTtFAo5B3EAqcIKni","MergeEffectToast");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.MergeEffectToast=o.MergeEffectType=void 0;var a=cc._decorator,c=a.ccclass,s=a.property;(function(t){t[t.MergeCount=0]="MergeCount",t[t.Combo=1]="Combo",t[t.CardUp=2]="CardUp",t[t.CardMax=3]="CardMax"})(o.MergeEffectType||(o.MergeEffectType={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aniNode=null,e.toastIcon=null,e.toastIconList=[],e.toastStr=null,e}return n(e,t),e.prototype.showToast=function(t,e,o){var r=this;this.toastIcon.spriteFrame=this.toastIconList[t],this.toastStr.string=e,cc.tween(this.aniNode).set({y:300,opacity:0}).to(.5,{y:0,opacity:255},{easing:"cubicInOut"}).delay(1).to(.2,{y:300,opacity:0},{easing:"cubicInOut"}).call(function(){r.node.destroy(),o&&o()}).start()},i([s(cc.Node)],e.prototype,"aniNode",void 0),i([s(cc.Sprite)],e.prototype,"toastIcon",void 0),i([s(cc.SpriteFrame)],e.prototype,"toastIconList",void 0),i([s(cc.Label)],e.prototype,"toastStr",void 0),i([c],e)}(cc.Component);o.MergeEffectToast=p,cc._RF.pop()},{}],PropBoard:[function(t,e,o){"use strict";cc._RF.push(e,"98147Lj2ShL84PDerYKt7x6","PropBoard");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.PropBoard=void 0;var a=t("./PropItem"),c=t("../event/EventBus"),s=cc._decorator,p=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normalNode=null,e.promptProp=null,e.bombProp=null,e.swapProp=null,e.usingPropNode=null,e}return n(e,t),e.prototype.onLoad=function(){this.changePropState(!1),c.ChangePropUseStateEvent.on(this.changePropState,this)},e.prototype.changePropState=function(t){cc.tween(this.normalNode).to(.2,{y:t?-200:0}).start(),cc.tween(this.usingPropNode).to(.2,{y:t?0:-200}).start()},e.prototype.cancelProp=function(){c.ChangePropUseStateEvent.emit(!1)},i([u(cc.Node)],e.prototype,"normalNode",void 0),i([u(a.PropItem)],e.prototype,"promptProp",void 0),i([u(a.PropItem)],e.prototype,"bombProp",void 0),i([u(a.PropItem)],e.prototype,"swapProp",void 0),i([u(cc.Node)],e.prototype,"usingPropNode",void 0),i([p],e)}(cc.Component);o.PropBoard=l,cc._RF.pop()},{"../event/EventBus":"EventBus","./PropItem":"PropItem"}],PropItem:[function(t,e,o){"use strict";cc._RF.push(e,"91a24Rh/ZNPKKKVi7423SPx","PropItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.PropItem=void 0;var a=t("../card-up/CardData"),c=t("../common/UIManager"),s=cc._decorator,p=s.ccclass,u=s.property,l=cc.Enum(a.PropType),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propType=a.PropType.Prompt,e}return n(e,t),e.prototype.onClickProp=function(){c.UIManager.showUI("PropUseTipView",{propType:this.propType})},i([u({type:l,tooltip:"\u9053\u5177\u7c7b\u578b"})],e.prototype,"propType",void 0),i([p],e)}(cc.Component);o.PropItem=d,cc._RF.pop()},{"../card-up/CardData":"CardData","../common/UIManager":"UIManager"}],PropTicket:[function(t,e,o){"use strict";cc._RF.push(e,"31859QTdGhF1Lk6owQ9RYN7","PropTicket");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.PropTicket=void 0;var a=t("../card-up/CardData"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ticketIcon=null,e.ticketFrames=[],e._propType=a.PropType.Prompt,e}return n(e,t),e.prototype.refresh=function(t){this._propType=t,this.ticketIcon.spriteFrame=this.ticketFrames[t]},i([p(cc.Sprite)],e.prototype,"ticketIcon",void 0),i([p(cc.SpriteFrame)],e.prototype,"ticketFrames",void 0),i([s],e)}(cc.Component);o.PropTicket=u,cc._RF.pop()},{"../card-up/CardData":"CardData"}],PropUseTipView:[function(t,e,o){"use strict";cc._RF.push(e,"6940cbMF6NJv4z2FHtk4aXG","PropUseTipView");var r,n,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.PropUseTipView=void 0;var c=t("../common/BaseUI"),s=t("../card-up/CardData"),p=t("../event/EventBus"),u=cc._decorator,l=u.ccclass,d=u.property,h=((n={})[s.PropType.Prompt]={name:"\u964d\u7ea7",desc:"\u4f7f\u7528\u540e\uff0c\u88ab\u9009\u4e2d\u7684\n\u4fbf\u7b7e\u7684\u5904\u7406\u4f18\u5148\u7ea7\u964d\u4f4e\u4e00\u7ea7",icon:"prop_prompt"},n[s.PropType.Bomb]={name:"\u5904\u7406",desc:"\u4f7f\u7528\u540e\uff0c\u88ab\u9009\u4e2d\u7684\n\u5e26\u76f8\u540c\u989c\u8272\u78c1\u94c1\u7684\u4fbf\u7b7e\u4f1a\u88ab\u6d88\u9664",icon:""},n[s.PropType.Exchange]={name:"\u786c\u5e01",desc:"\u4f7f\u7528\u540e\uff0c\u88ab\u9009\u4e2d\u7684\u4fbf\u7b7e\n\u53ef\u4ee5\u548c\u4efb\u610f\u4fbf\u7b7e\u6216\u8005\u7a7a\u69fd\u4ea4\u6362\u4f4d\u7f6e",icon:"prop_coin"},n),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.titleLbl=null,e.icon=null,e.iconList=[],e.descLbl=null,e._data=null,e}return i(e,t),e.prototype.initData=function(e){t.prototype.initData.call(this,e),this._data=e;var o=h[e.propType];this.titleLbl.string=o.name,this.icon.spriteFrame=this.iconList[e.propType],this.descLbl.string=o.desc},e.prototype.onUseClick=function(){p.ChangePropUseStateEvent.emit(!0),p.UsePropEvent.emit(this._data.propType),this.close()},a([d(cc.Label)],e.prototype,"titleLbl",void 0),a([d(cc.Sprite)],e.prototype,"icon",void 0),a([d(cc.SpriteFrame)],e.prototype,"iconList",void 0),a([d(cc.Label)],e.prototype,"descLbl",void 0),a([l],e)}(c.BaseUI);o.PropUseTipView=f,cc._RF.pop()},{"../card-up/CardData":"CardData","../common/BaseUI":"BaseUI","../event/EventBus":"EventBus"}],SettingsView:[function(t,e,o){"use strict";cc._RF.push(e,"27b91SFuMVLEZ0yWs0ilFps","SettingsView");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SettingsView=void 0;var a=t("../common/BaseUI"),c=t("../common/SoundManager"),s=t("../event/EventBus"),p=cc._decorator,u=p.ccclass,l=p.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgmToggle=null,e.sfxToggle=null,e.vibrationToggle=null,e}return n(e,t),e.prototype.initData=function(e){t.prototype.initData.call(this,e),this.bgmToggle.isChecked=c.SoundManager.bgmOpen,this.sfxToggle.isChecked=c.SoundManager.sfxOpen,this.vibrationToggle.isChecked=c.SoundManager.vibrationOpen},e.prototype.onCloseBtnClick=function(){this.close()},e.prototype.onBgmToggleChanged=function(){c.SoundManager.setBgmOpen(this.bgmToggle.isChecked),this.bgmToggle.isChecked?c.SoundManager.resumeMusic():c.SoundManager.pauseMusic()},e.prototype.onSfxToggleChanged=function(){c.SoundManager.setSfxOpen(this.sfxToggle.isChecked),this.sfxToggle.isChecked||c.SoundManager.stopEffect()},e.prototype.onVibrationToggleChanged=function(){c.SoundManager.setVibrationOpen(this.vibrationToggle.isChecked)},e.prototype.onResetGameBtnClick=function(){s.ResetGameEvent.emit(),this.close()},i([l(cc.Toggle)],e.prototype,"bgmToggle",void 0),i([l(cc.Toggle)],e.prototype,"sfxToggle",void 0),i([l(cc.Toggle)],e.prototype,"vibrationToggle",void 0),i([u],e)}(a.BaseUI);o.SettingsView=d,cc._RF.pop()},{"../common/BaseUI":"BaseUI","../common/SoundManager":"SoundManager","../event/EventBus":"EventBus"}],SoundManager:[function(t,e,o){"use strict";cc._RF.push(e,"9b67b3gmcNH0ZIgSmlUiAqS","SoundManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.SoundManager=void 0;var r=t("./LocalCache"),n=function(){function t(){}return t.init=function(){this.bgmOpen=0==r.LocalCache.getItem(r.LocalCacheKey.bgmMute,0),this.sfxOpen=0==r.LocalCache.getItem(r.LocalCacheKey.sfxMute,0),this.vibrationOpen=0==r.LocalCache.getItem(r.LocalCacheKey.vibrationMute,0)},t.setBgmOpen=function(t){this.bgmOpen=t,r.LocalCache.setItem(r.LocalCacheKey.bgmMute,t?0:1)},t.setSfxOpen=function(t){this.sfxOpen=t,r.LocalCache.setItem(r.LocalCacheKey.sfxMute,t?0:1)},t.setVibrationOpen=function(t){this.vibrationOpen=t,r.LocalCache.setItem(r.LocalCacheKey.vibrationMute,t?0:1)},t.playEffect=function(t){if(this.sfxOpen){var e=this.soundPathPrefix+t;cc.resources.load(e,cc.AudioClip,function(t,e){t||cc.audioEngine.playEffect(e,!1)})}},t.playMusic=function(t){if(this.bgmOpen){var e=this.soundPathPrefix+t;cc.resources.load(e,cc.AudioClip,function(t,e){t||cc.audioEngine.playMusic(e,!0)})}else this._lastBgmName=t},t.stopMusic=function(){cc.audioEngine.stopMusic()},t.stopEffect=function(){cc.audioEngine.stopAllEffects()},t.resumeMusic=function(){this._lastBgmName?(this.playMusic(this._lastBgmName),this._lastBgmName=""):cc.audioEngine.resumeMusic()},t.pauseMusic=function(){cc.audioEngine.pauseMusic()},t.bgmOpen=!0,t.sfxOpen=!0,t.vibrationOpen=!0,t._lastBgmName="",t.soundPathPrefix="audio/",t}();o.SoundManager=n,cc._RF.pop()},{"./LocalCache":"LocalCache"}],TypedEvents:[function(t,e,o){"use strict";cc._RF.push(e,"3f0b3k6789OA7SFTH52pWd0","TypedEvents");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.createEventEmitter=o.TEvent=o.createEmitter=o.SealedEvent=o.BaseEvent=void 0;var i=function(){function t(){this.listeners=[]}return t.prototype.on=function(t,e){var o=this;if(!this.listeners.find(function(o){return t===o.callback&&e===o.target}))return this.listeners.push({target:e,once:!1,callback:t}),function(){o.off(t,e)};console.error("\u5df2\u7ecf\u5b58\u5728\u76f8\u540c\u7684\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570: "+t)},t.prototype.once=function(t,e){var o=this;if(!t){var r=new Promise(function(t){o.once(t)});return this.listeners[this.listeners.length-1].promise=r,r}this.listeners.push({target:e,once:!0,callback:t})},t.prototype.off=function(t,e){var o=this.listeners.length;return this.listeners=this.listeners.filter(function(o){return e!=o.target||t!==o.callback&&(!o.promise||t!==o.promise)}),this.listeners.length!==o},t.prototype.offAll=function(){var t=this.listeners.length;return this.listeners.length=0,t},t}();o.BaseEvent=i;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i);function c(t){var e=t;function o(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];for(var r=e.listeners,n=r.length>0,i=0,a=r;i<a.length;i++){var c=a[i];try{c.callback.apply(c.target,t)}catch(p){console.error("\u4e8b\u4ef6\u56de\u8c03\u6267\u884c\u51fa\u9519",p)}}for(var s=e.listeners.length-1;s>=0;s--)e.listeners[s].once&&e.listeners.splice(s,1);return n}var r=o;return r.event=t,r.emit=o,r}o.SealedEvent=a,o.createEmitter=function(){return c(new a)};var s=function(t){function e(){var e=t.call(this)||this;return e.emit=c(e),e}return n(e,t),e}(i);o.TEvent=s,o.createEventEmitter=function(){return c(new s)},cc._RF.pop()},{}],UIManager:[function(t,e,o){"use strict";cc._RF.push(e,"96ec0+Ed4FAy6d3NIU3hU0O","UIManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIManager=void 0;var r=t("./BaseUI"),n=function(){function t(){}return t.showUI=function(t,e){cc.resources.load("prefabs/"+t,cc.Prefab,function(t,o){if(t)console.error(t);else{var n=cc.instantiate(o);cc.director.getScene().addChild(n);var i=n.getComponent(r.BaseUI);i&&i.show(e)}})},t}();o.UIManager=n,cc._RF.pop()},{"./BaseUI":"BaseUI"}],Utils:[function(t,e,o){"use strict";cc._RF.push(e,"63915WnfwhNNqLbG1rFORxU","Utils"),Object.defineProperty(o,"__esModule",{value:!0}),o.Utils=void 0;var r=function(){function t(){}return t.loadSpriteFrame=function(t,e){cc.resources.load(e,cc.SpriteFrame,function(e,o){e?cc.error(e):t&&cc.isValid(t)&&(t.spriteFrame=o)})},t}();o.Utils=r,cc._RF.pop()},{}],schema:[function(t,e,o){"use strict";var r;cc._RF.push(e,"95375QtqM5Jh7/Kk+Bb++SV","schema"),Object.defineProperty(o,"__esModule",{value:!0}),o.Tables=o.vector4=o.vector3=o.vector2=o.CardWeight=o.cfg=void 0,function(t){(function(t){t[t.None=0]="None",t[t.PassGuideStage=1]="PassGuideStage",t[t.Authorized=2]="Authorized",t[t.PassNewbieStage=4]="PassNewbieStage"})(t.EGuideType||(t.EGuideType={}))}(r=o.cfg||(o.cfg={})),function(t){(function(t){t[t.DressUp=1]="DressUp",t[t.Plank=2]="Plank"})(t.EItemType||(t.EItemType={}))}(r=o.cfg||(o.cfg={}));var n=function(){function t(t){if(void 0===t.key)throw new Error;if(this.key=t.key,void 0===t.weight)throw new Error;this.weight=t.weight}return t.prototype.resolve=function(t){this.key_ref=t.GDCards.get(this.key)},t}();o.CardWeight=n,function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.money)throw new Error;if(this.money=t.money,void 0===t.describe)throw new Error;this.describe=t.describe}return t.prototype.resolve=function(){},t}();t.GDCardData=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.cardCountWeight)throw new Error;this.cardCountWeight=[];for(var e=0,o=t.cardCountWeight;e<o.length;e++){var r=o[e],i=void 0;i=new n(r),this.cardCountWeight.push(i)}if(void 0===t.cardIdWeight)throw new Error;this.cardIdWeight=[];for(var a=0,c=t.cardIdWeight;a<c.length;a++)r=c[a],i=void 0,i=new n(r),this.cardIdWeight.push(i)}return t.prototype.resolve=function(t){for(var e=0,o=this.cardCountWeight;e<o.length;e++)null==(i=o[e])||i.resolve(t);for(var r=0,n=this.cardIdWeight;r<n.length;r++){var i;null==(i=n[r])||i.resolve(t)}},t}();t.GDCardGroupData=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.multi_rate)throw new Error;this.multiRate=[];for(var e=0,o=t.multi_rate;e<o.length;e++){var r;r=o[e],this.multiRate.push(r)}}return t.prototype.resolve=function(){},t}();t.GDCommonData=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.rank)throw new Error;if(this.rank=t.rank,void 0===t.target_type)throw new Error;if(this.targetType=t.target_type,void 0===t.target1)throw new Error;if(this.target1=t.target1,void 0===t.target2)throw new Error;this.target2=t.target2}return t.prototype.resolve=function(){},t}();t.GDKPIData=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.level)throw new Error;if(this.level=t.level,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.res)throw new Error;if(this.res=t.res,void 0===t.hex_color)throw new Error;if(this.hexColor=t.hex_color,void 0===t.describe)throw new Error;this.describe=t.describe}return t.prototype.resolve=function(){},t}();t.GDLevelData=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.level)throw new Error;if(this.level=t.level,void 0===t.groupWeight)throw new Error;this.groupWeight=[];for(var e=0,o=t.groupWeight;e<o.length;e++){var r,i=o[e];r=new n(i),this.groupWeight.push(r)}}return t.prototype.resolve=function(t){for(var e=0,o=this.groupWeight;e<o.length;e++){var r=o[e];null==r||r.resolve(t)}},t}();t.GDLevelGroupData=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.c_id)throw new Error;if(this.cId=t.c_id,void 0===t.card_count)throw new Error;if(this.cardCount=t.card_count,void 0===t.describe)throw new Error;if(this.describe=t.describe,void 0===t.score_rate)throw new Error;this.scoreRate=t.score_rate}return t.prototype.resolve=function(t){this.cId_ref=t.GDCards.get(this.cId)},t}();t.GDMergeResultData=e}(r=o.cfg||(o.cfg={}));var i=function(){function t(t){if(void 0===t.x)throw new Error;if(this.x=t.x,void 0===t.y)throw new Error;this.y=t.y}return t.prototype.resolve=function(){},t}();o.vector2=i;var a=function(){function t(t){if(void 0===t.x)throw new Error;if(this.x=t.x,void 0===t.y)throw new Error;if(this.y=t.y,void 0===t.z)throw new Error;this.z=t.z}return t.prototype.resolve=function(){},t}();o.vector3=a;var c=function(){function t(t){if(void 0===t.x)throw new Error;if(this.x=t.x,void 0===t.y)throw new Error;if(this.y=t.y,void 0===t.z)throw new Error;if(this.z=t.z,void 0===t.w)throw new Error;this.w=t.w}return t.prototype.resolve=function(){},t}();o.vector4=c,function(t){var e=function(){function e(e){if(1!=e.length)throw new Error("table mode=one, but size != 1");this._data=new t.GDCommonData(e[0])}return e.prototype.getData=function(){return this._data},Object.defineProperty(e.prototype,"multiRate",{get:function(){return this._data.multiRate},enumerable:!1,configurable:!0}),e.prototype.resolve=function(t){this._data.resolve(t)},e}();t.GDCommon=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var o=0,r=e;o<r.length;o++){var n,i=r[o];n=new t.GDCardData(i),this._dataList.push(n),this._dataMap.set(n.id,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,o=this._dataList;e<o.length;e++)o[e].resolve(t)},e}();t.GDCards=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var o=0,r=e;o<r.length;o++){var n,i=r[o];n=new t.GDCardGroupData(i),this._dataList.push(n),this._dataMap.set(n.id,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,o=this._dataList;e<o.length;e++)o[e].resolve(t)},e}();t.GDCardsGroup=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var o=0,r=e;o<r.length;o++){var n,i=r[o];n=new t.GDLevelGroupData(i),this._dataList.push(n),this._dataMap.set(n.level,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,o=this._dataList;e<o.length;e++)o[e].resolve(t)},e}();t.GDLevelGroup=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function e(e){this._dataList=[];for(var o=0,r=e;o<r.length;o++){var n,i=r[o];n=new t.GDMergeResultData(i),this._dataList.push(n)}}return e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataList[t]},e.prototype.resolve=function(t){for(var e=0,o=this._dataList;e<o.length;e++)o[e].resolve(t)},e}();t.GDMergeResult=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var o=0,r=e;o<r.length;o++){var n,i=r[o];n=new t.GDKPIData(i),this._dataList.push(n),this._dataMap.set(n.id,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,o=this._dataList;e<o.length;e++)o[e].resolve(t)},e}();t.GDKPI=e}(r=o.cfg||(o.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var o=0,r=e;o<r.length;o++){var n,i=r[o];n=new t.GDLevelData(i),this._dataList.push(n),this._dataMap.set(n.level,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,o=this._dataList;e<o.length;e++)o[e].resolve(t)},e}();t.GDLevel=e}(r=o.cfg||(o.cfg={}));var s=function(){function t(t){this._GDCommon=new r.GDCommon(t("cfg_gdcommon")),this._GDCards=new r.GDCards(t("cfg_gdcards")),this._GDCardsGroup=new r.GDCardsGroup(t("cfg_gdcardsgroup")),this._GDLevelGroup=new r.GDLevelGroup(t("cfg_gdlevelgroup")),this._GDMergeResult=new r.GDMergeResult(t("cfg_gdmergeresult")),this._GDKPI=new r.GDKPI(t("cfg_gdkpi")),this._GDLevel=new r.GDLevel(t("cfg_gdlevel")),this._GDCommon.resolve(this),this._GDCards.resolve(this),this._GDCardsGroup.resolve(this),this._GDLevelGroup.resolve(this),this._GDMergeResult.resolve(this),this._GDKPI.resolve(this),this._GDLevel.resolve(this)}return Object.defineProperty(t.prototype,"GDCommon",{get:function(){return this._GDCommon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDCards",{get:function(){return this._GDCards},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDCardsGroup",{get:function(){return this._GDCardsGroup},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDLevelGroup",{get:function(){return this._GDLevelGroup},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDMergeResult",{get:function(){return this._GDMergeResult},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDKPI",{get:function(){return this._GDKPI},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDLevel",{get:function(){return this._GDLevel},enumerable:!1,configurable:!0}),t}();o.Tables=s,cc._RF.pop()},{}]},{},["CardBoardData","CardData","CardGroup","CardItem","CardOptionGenerator","GridItem","MergeBoard","MergeEffectToast","BaseUI","BtnExt","GlobalConfigMgr","LocalCache","SoundManager","TypedEvents","UIManager","Utils","schema","EventBus","FailView","KPIManager","KpiTaskBoard","KpiTaskItem","KpiTaskProgressItem","KpiTaskView","LevelUpView","LoadingScene","PropBoard","PropItem","PropTicket","PropUseTipView","SettingsView"]);