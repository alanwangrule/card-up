window.__require=function t(e,r,o){function n(a,c){if(!r[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var p="function"==typeof __require&&__require;if(!c&&p)return p(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){return n(e[a][1][t]||t)},u,u.exports,t,e,r,o)}return r[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)n(o[a]);return n}({BaseUI:[function(t,e,r){"use strict";cc._RF.push(e,"7ee21TmtQdNLo02xs8k9Lm5","BaseUI");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.BaseUI=void 0;var a=cc._decorator,c=a.ccclass,s=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.closeBtn=null,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.node.getComponent(cc.BlockInputEvents)||this.node.addComponent(cc.BlockInputEvents),this.closeBtn.on("click",function(){t.close()})},e.prototype.show=function(t){this.node.active=!0,this.initData(t)},e.prototype.initData=function(){},e.prototype.close=function(){this.node.destroy()},i([s(cc.Node)],e.prototype,"closeBtn",void 0),i([c],e)}(cc.Component);r.BaseUI=p,cc._RF.pop()},{}],CardBoardData:[function(t,e,r){"use strict";cc._RF.push(e,"af96ccat8RNT46nPJK0895O","CardBoardData"),Object.defineProperty(r,"__esModule",{value:!0}),r.CardBoardData=void 0;var o=t("./CardData"),n=t("../common/GlobalConfigMgr"),i=function(){function t(){this.maxLv=1,this.cardMatrix=[],this.cardLvGroup=null,this.groupIdx=0,this.curCardOption=null,this.nextCardOption=null}return t.prototype.restoreSnapShot=function(t){this.cardMatrix=t.matrix,this.maxLv=t.maxLv,this.curCardOption=t.curOption,this.nextCardOption=t.nextOption,this.groupIdx=0,this.decideCardGroup()},t.prototype.resetBoard=function(){for(var t=o.GameConfig.matrixSize,e=0;e<t;e++){var r=[];r.length=t,this.cardMatrix.push(r)}this.maxLv=1,this.groupIdx=0,this.decideCardGroup(),this.curCardOption=this.createCardOption(),this.nextCardOption=this.createCardOption()},t.prototype.getSnapshot=function(){return{matrix:this.cardMatrix,maxLv:this.maxLv,curOption:this.curCardOption,nextOption:this.nextCardOption}},t.prototype.getCardMatrix=function(){return this.cardMatrix},t.prototype.getCurCardOption=function(){return this.curCardOption},t.prototype.getNextCardOption=function(){return this.nextCardOption},t.prototype.generateNextCardOption=function(){this.curCardOption=this.nextCardOption,this.nextCardOption=this.createCardOption()},t.prototype.decideCardGroup=function(){this.cardLvGroup&&this.cardLvGroup.level===this.maxLv||(this.cardLvGroup=n.GlobalConfigMgr.Tables.GDLevelGroup.get(this.maxLv))},t.prototype.getCardData=function(t,e){var r=this.cardMatrix[t];return r?r[e]:(console.error("\u68cb\u76d8\u6570\u636e\u9519\u8bef\uff0cx\u8d85\u51fa\u8303\u56f4"),null)},t.prototype.setCardData=function(t,e,r){var o=this.cardMatrix[e];(!o||o.length<=t)&&console.warn("\u8bbe\u7f6e\u7684\u4f4d\u7f6e\u4e0d\u5408\u6cd5"),o[t]=r},t.prototype.checkMatrixFull=function(){for(var t=0,e=this.cardMatrix;t<e.length;t++)for(var r=0,o=e[t];r<o.length;r++)if(!o[r])return!1;return!0},t.prototype.createCardOption=function(t){void 0===t&&(t=!1);var e=[],r=this.getItemByWeights(this.cardLvGroup.groupWeight),i=n.GlobalConfigMgr.Tables.GDCardsGroup.get(r.key),a=this.getItemByWeights(i.cardCountWeight).key;if(t||1===a){var c=this.createCard(i);e.push(c)}else{var s=this.createCard(i),p=this.createCard(i);s.level===p.level&&(s.isMajorCard=!0),e.push(s,p)}return this.groupIdx++,{cards:e,dir:o.CardDir.TopToBottom}},t.prototype.forceReplaceCurOptionToSingleCard=function(){var t=this.createCardOption(!0);return this.curCardOption=t,t},t.prototype.createCard=function(t){var e=this.getItemByWeights(t.cardIdWeight);return{groupIdx:this.groupIdx,level:e.key,color:this.getCardColor(),isMajorCard:!1}},t.prototype.createCardForLevel=function(t,e){return n.GlobalConfigMgr.Tables.GDCards.get(e)?{groupIdx:t.groupIdx,color:t.color,level:e,isMajorCard:!1}:null},t.prototype.getCardColor=function(){return Math.floor(4*Math.random())},t.prototype.checkLvAboveMax=function(t){return t>this.maxLv&&(this.maxLv=t,this.decideCardGroup(),!0)},t.prototype.getItemByWeights=function(t){for(var e=t.reduce(function(t,e){return t+e.weight},0),r=Math.random()*e,o=0,n=0,i=t;n<i.length;n++){var a=i[n];if(r<(o+=a.weight))return a}return null},t}();r.CardBoardData=i,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","./CardData":"CardData"}],CardData:[function(t,e,r){"use strict";cc._RF.push(e,"1bcd9oTX/1A97C0q+GNrMLk","CardData"),Object.defineProperty(r,"__esModule",{value:!0}),r.PropType=r.CardDir=r.GameConfig=void 0,r.GameConfig={matrixSize:5,maxLv:7,magColors:[{name:"\u6a58\u8272",color:"#FFA200"},{name:"\u7ea2\u8272",color:"#E8342D"},{name:"\u7eff\u8272",color:"#09A769"},{name:"\u84dd\u8272",color:"#2171E9"}]},function(t){t[t.LeftToRight=0]="LeftToRight",t[t.TopToBottom=1]="TopToBottom",t[t.RightToLeft=2]="RightToLeft",t[t.BottomToTop=3]="BottomToTop"}(r.CardDir||(r.CardDir={})),function(t){t[t.Prompt=0]="Prompt",t[t.Bomb=1]="Bomb",t[t.Exchange=2]="Exchange"}(r.PropType||(r.PropType={})),cc._RF.pop()},{}],CardGroup:[function(t,e,r){"use strict";cc._RF.push(e,"e94b712m9lM3ZbFtAT8w3EW","CardGroup");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.CardGroup=void 0;var a=t("./CardData"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.container=null,e._cardOption=null,e._cards=[],e._offset=5,e}return n(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t){this._cards=t;for(var e=0;e<t.length;e++){var r=t[e];r.node.parent=this.container,r.node.active=!1}},e.prototype.getOptionData=function(){return this._cardOption},e.prototype.getCardJudgeOffset=function(){var t=this._cardOption.dir,e=t===a.CardDir.LeftToRight||t===a.CardDir.RightToLeft,r=this._cardOption.cards.length;return{col:e?r:1,row:e?1:r}},e.prototype.refresh=function(t){this._cardOption=t;for(var e=t.cards,r=0;r<e.length;r++){var o=e[r],n=this._cards[r];n.node.active=!0,n.refreshCard(o,!0);var i=cc.Vec3.ZERO;e.length>1&&(i=this.getCardPos(r,t.dir,n.node)),n.node.setPosition(i)}for(r=e.length;r<this._cards.length;r++)this._cards[r].node.active=!1},e.prototype.getCardPositions=function(){for(var t=[],e=0;e<this._cards.length;e++){var r=this._cards[e];r.node.active&&t.push(r.node.position)}return t},e.prototype.breathEffect=function(t){if(!t)return cc.Tween.stopAllByTarget(this.container),void(this.container.scale=1);cc.Tween.stopAllByTarget(this.container),cc.tween(this.container).repeatForever(cc.tween().to(.5,{scale:.9}).to(.5,{scale:1})).start()},e.prototype.rotateCards=function(){if(this._cardOption.cards.length<=1)return-1;var t=this._cardOption.dir+1;t>a.CardDir.BottomToTop?this._cardOption.dir=t=a.CardDir.LeftToRight:this._cardOption.dir=t;for(var e=0;e<this._cards.length;e++){var r=this._cards[e],o=this.getCardPos(e,t,r.node);cc.Tween.stopAllByTarget(r.node),cc.tween(r.node).to(.1,{position:o},{easing:"sineInOut"}).start()}return t},e.prototype.getCardPos=function(t,e,r){var o=r.width+this._offset,n=r.height+this._offset,i=0,c=0;switch(e){case a.CardDir.BottomToTop:c=t-.5;break;case a.CardDir.LeftToRight:i=t-.5;break;case a.CardDir.RightToLeft:i=.5-t;break;case a.CardDir.TopToBottom:c=.5-t}return cc.v3(i*o,c*n)},i([p(cc.Node)],e.prototype,"container",void 0),i([s],e)}(cc.Component);r.CardGroup=u,cc._RF.pop()},{"./CardData":"CardData"}],CardItem:[function(t,e,r){"use strict";cc._RF.push(e,"87f82nOzeVPD7/n2UjOKTYm","CardItem");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.CardItem=void 0;var a=t("../common/GlobalConfigMgr"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aniNode=null,e.cardLv=null,e.groupTag=null,e.groupTagList=[],e.primaryTag=null,e._cardData=null,e}return n(e,t),e.prototype.refreshCard=function(t,e){void 0===e&&(e=!1),this._cardData=t,this.primaryTag.active=e&&t.isMajorCard,this.groupTag.spriteFrame=this.groupTagList[t.color];var r=a.GlobalConfigMgr.Tables.GDCards.get(t.level);this.cardLv.string=r.name},e.prototype.getCardData=function(){return this._cardData},e.prototype.mergeEffect=function(t,e){var r,o=t.length,n=.2/o;if(cc.Tween.stopAllByTarget(this.node),t.length>1){for(var i=[],a=0;a<o;a++){var c=t[a],s=cc.tween(this.node).to(n,{position:c});i.push(s)}(r=cc.tween(this.node)).sequence.apply(r,i).call(e).start()}else cc.tween(this.node).to(n,{position:t[0]}).call(e).start()},e.prototype.levelUpEffect=function(t,e){this.refreshCard(t),this.cardLv.node.scale=0,cc.tween(this.cardLv.node).to(.2,{scale:1}).call(e).start()},e.prototype.levelMaxEffect=function(t){cc.tween(this.aniNode).to(.1,{scale:1.2}).to(.2,{scale:0}).call(t).start()},i([p(cc.Node)],e.prototype,"aniNode",void 0),i([p(cc.Label)],e.prototype,"cardLv",void 0),i([p(cc.Sprite)],e.prototype,"groupTag",void 0),i([p(cc.SpriteFrame)],e.prototype,"groupTagList",void 0),i([p(cc.Node)],e.prototype,"primaryTag",void 0),i([s],e)}(cc.Component);r.CardItem=u,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr"}],CardOptionGenerator:[function(t,e,r){"use strict";cc._RF.push(e,"a9939d2qyROqrxv+SytCRWf","CardOptionGenerator"),Object.defineProperty(r,"__esModule",{value:!0}),r.CardOptionGenerator=void 0;var o=function(){function t(){this.groupConf=null,this.groupDataConf=null}return t.prototype.getCardOption=function(){},t}();r.CardOptionGenerator=o,cc._RF.pop()},{}],EventBus:[function(t,e,r){"use strict";cc._RF.push(e,"1fe466b5jpIPaGF5u0Dc06N","EventBus"),Object.defineProperty(r,"__esModule",{value:!0}),r.ResetGameEvent=r.LevelUpdateEvent=r.TaskUpdateEvent=r.KpiScoreUpdateEvent=void 0;var o=t("../common/TypedEvents");r.KpiScoreUpdateEvent=new o.TEvent,r.TaskUpdateEvent=new o.TEvent,r.LevelUpdateEvent=new o.TEvent,r.ResetGameEvent=new o.TEvent,cc._RF.pop()},{"../common/TypedEvents":"TypedEvents"}],GlobalConfigMgr:[function(t,e,r){"use strict";cc._RF.push(e,"40694DbJRVL3oEv98eLbYEz","GlobalConfigMgr");var o=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,i){function a(t){try{s(o.next(t))}catch(e){i(e)}}function c(t){try{s(o.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(a,c)}s((o=o.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(t){return function(e){return s([t,e])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.GlobalConfigMgr=void 0;var i=t("../data-cfg/type/schema"),a=function(){function t(){}return t.init=function(){return o(this,void 0,void 0,function(){return n(this,function(){return[2,new Promise(function(e,r){cc.resources.loadDir("data/json",cc.JsonAsset,function(o,n){if(o)return console.error(o),void r(o);t.Tables=new i.Tables(function(t){for(var e=0,r=n;e<r.length;e++){var o=r[e];if(o.name===t)return o.json}return null}),e()})})]})})},t.Tables=null,t}();r.GlobalConfigMgr=a,cc._RF.pop()},{"../data-cfg/type/schema":"schema"}],GridItem:[function(t,e,r){"use strict";cc._RF.push(e,"f40411MNrFNJYWfgyBfQKd0","GridItem");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.GridItem=void 0;var a=cc._decorator,c=a.ccclass,s=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.debugLbl=null,e.bgNode=null,e._cardItem=null,e._colRowInMatrix=null,e}return n(e,t),e.prototype.init=function(t,e){this.node.name="grid_"+e+"_"+t,this._colRowInMatrix={col:t,row:e},this.debugLbl.string=""},e.prototype.getColRow=function(){return this._colRowInMatrix},e.prototype.updateCardItem=function(t){t&&(t.node.name="card_"+this._colRowInMatrix.row+"_"+this._colRowInMatrix.col),this._cardItem=t,this._cardItem?this.debugLbl.string=""+t.getCardData().level:this.debugLbl.string=""},e.prototype.getCardItem=function(){return this._cardItem},e.prototype.isHoldCard=function(){return null!=this._cardItem},e.prototype.changeHoverState=function(t){this.bgNode.color=t?cc.Color.GRAY:cc.Color.WHITE},i([s(cc.Label)],e.prototype,"debugLbl",void 0),i([s(cc.Node)],e.prototype,"bgNode",void 0),i([c],e)}(cc.Component);r.GridItem=p,cc._RF.pop()},{}],KPIManager:[function(t,e,r){"use strict";cc._RF.push(e,"c22e3Uf3fZE/aMVNN1RHk7P","KPIManager"),Object.defineProperty(r,"__esModule",{value:!0}),r.KPIManager=r.KpiType=r.KpiState=void 0;var o,n,i=t("../common/LocalCache"),a=t("../common/GlobalConfigMgr"),c=t("../event/EventBus"),s=t("../card-up/CardData");(function(t){t[t.None=0]="None",t[t.Progress=1]="Progress",t[t.Finish=2]="Finish"})(o=r.KpiState||(r.KpiState={})),function(t){t[t.Score=1]="Score",t[t.Combo=2]="Combo",t[t.MultiMerge=3]="MultiMerge",t[t.MergeLevel=4]="MergeLevel",t[t.MergeCount=5]="MergeCount"}(n=r.KpiType||(r.KpiType={}));var p=function(){function t(){this._gameData=null,this._historyData=null,this._kpiList=[],this._dataDirty=!1}return t.prototype.init=function(){var t=this,e=i.LocalCache.getItem(i.LocalCacheKey.gameData,null);if(e){this._gameData=JSON.parse(e);var r=this._gameData.level;if(this._kpiList=this.getKpiListForLevel(r),this._kpiList)for(var o=0;o<this._gameData.tasks.length;o++){var n=this._gameData.tasks[o];this._kpiList[o].curCount=n.progress}}else this._gameData={props:[0,0,0],tasks:[],level:1,score:0},this._kpiList=this.getKpiListForLevel(1),this._gameData.tasks=this._kpiList.map(function(t){return{id:t.id,progress:0}});this.updateKpiList(),setInterval(function(){t._dataDirty&&(t.saveGameData(),t._dataDirty=!1)},1e3)},Object.defineProperty(t.prototype,"GDKpi",{get:function(){return a.GlobalConfigMgr.Tables.GDKPI},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kpiScore",{get:function(){return this._gameData.score},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rankLevel",{get:function(){return this._gameData.level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kpiList",{get:function(){return this._kpiList},enumerable:!1,configurable:!0}),t.prototype.updateKpiList=function(){for(var t=!0,e=0,r=this._kpiList;e<r.length;e++){var n=r[e],i=this.GDKpi.get(n.id);n.curCount>=i.target1?n.state=o.Finish:(n.state=o.Progress,t=!1)}c.TaskUpdateEvent.emit(),t&&(this._gameData.level++,this._kpiList=this.getKpiListForLevel(this._gameData.level),this._dataDirty=!0,c.LevelUpdateEvent.emit(this._gameData.level))},t.prototype.saveGameData=function(){this._gameData.tasks=this._kpiList.map(function(t){return{id:t.id,progress:t.curCount}}),i.LocalCache.setItem(i.LocalCacheKey.gameData,JSON.stringify(this._gameData))},t.prototype.getHistoryData=function(){if(!this._historyData){var t=i.LocalCache.getItem(i.LocalCacheKey.historyData,null);this._historyData=t?JSON.parse(t):{historyBestScore:0,todayDate:"",dailyBestScore:0}}return this._historyData},t.prototype.setHistoryData=function(t){var e=this.getHistoryData(),r=(new Date).toLocaleDateString();e.todayDate!==r&&(e.todayDate=r,e.dailyBestScore=0),t>e.historyBestScore&&(e.historyBestScore=t),t>e.dailyBestScore&&(e.dailyBestScore=t),i.LocalCache.setItem(i.LocalCacheKey.historyData,JSON.stringify(e))},t.prototype.getKpiListForLevel=function(t){var e=[],r=a.GlobalConfigMgr.Tables.GDKPI.getDataList().filter(function(e){return e.rank===t});r.sort(function(t,e){return t.id-e.id});for(var n=0,i=r;n<i.length;n++){var c=i[n],s={id:c.id,curCount:0,conf:c,state:o.Progress};e.push(s)}return e},t.prototype.resetKpiScore=function(){this._gameData.score=0,this._dataDirty=!0,c.KpiScoreUpdateEvent.emit(this._gameData.score)},t.prototype.addKpiScore=function(t){this._gameData.score+=t,c.KpiScoreUpdateEvent.emit(this._gameData.score);for(var e=0,r=this._kpiList;e<r.length;e++){var o=r[e];this.GDKpi.get(o.id).targetType===n.Score&&(o.curCount+=t,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiCombo=function(t){for(var e=0,r=this._kpiList;e<r.length;e++){var o=r[e];this.GDKpi.get(o.id).targetType===n.Combo&&(o.curCount+=t,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiMergeLevelCount=function(t,e){for(var r=0,o=this._kpiList;r<o.length;r++){var i=o[r],a=this.GDKpi.get(i.id);a.targetType===n.MergeLevel&&a.target2===t&&(i.curCount+=e,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiMergeColorCount=function(t,e){for(var r=0,o=this._kpiList;r<o.length;r++){var i=o[r],a=this.GDKpi.get(i.id);a.targetType===n.MergeCount&&a.target2===t&&(i.curCount+=e,this._dataDirty=!0)}this.updateKpiList()},t.prototype.addKpiMultiMerge=function(t,e){for(var r=0,o=this._kpiList;r<o.length;r++){var i=o[r],a=this.GDKpi.get(i.id);a.targetType===n.MultiMerge&&a.target2===t&&(i.curCount+=e,this._dataDirty=!0)}this.updateKpiList()},t.prototype.getKpiDesc=function(t){var e=t.conf,r=e.target1,o=e.target2;switch(e.targetType){case n.Score:return"\u83b7\u5f97\u85aa\u8d44<br/>\u3010"+r+"\u3011";case n.Combo:return"\u8fde\u7eed\u5408\u6210<br/>\u3010"+r+"\u3011\u6b21";case n.MergeLevel:return"\u5408\u6210"+a.GlobalConfigMgr.Tables.GDCards.get(o).describe+"<br/>\u3010"+r+"\u3011\u6b21";case n.MergeCount:var i=s.GameConfig.magColors[o];return"\u5408\u6210<color="+i.color+">"+i.name+"</color>\u4e8b\u9879<br/>\u3010"+r+"\u3011\u6b21";case n.MultiMerge:return"\u5355\u6b21\u5408\u6210"+a.GlobalConfigMgr.Tables.GDCards.get(o).describe+"<br/>\u3010"+r+"\u3011\u6b21";default:return""}},t.instance=new t,t}();r.KPIManager=p,cc._RF.pop()},{"../card-up/CardData":"CardData","../common/GlobalConfigMgr":"GlobalConfigMgr","../common/LocalCache":"LocalCache","../event/EventBus":"EventBus"}],KpiTaskBoard:[function(t,e,r){"use strict";cc._RF.push(e,"837bakx6fVCZYmhbmu9yeI0","KpiTaskBoard");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.KpiTaskBoard=void 0;var a=t("../event/EventBus"),c=t("./KpiTaskProgressItem"),s=t("./KPIManager"),p=t("../common/Utils"),u=t("../common/GlobalConfigMgr"),l=t("../common/UIManager"),h=cc._decorator,d=h.ccclass,f=h.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.kpiScoreLbl=null,e.kpiProgressContainers=[],e.kpiProgressItemPrefab=null,e.rankLevelSkeleton=null,e.nextRankLevelNode=null,e.nextRankLevelIcon=null,e.curRankLeveSprite=null,e._kpiProgressItems=[],e}return n(e,t),e.prototype.onLoad=function(){s.KPIManager.instance.init();for(var t=0;t<3;t++){var e=cc.instantiate(this.kpiProgressItemPrefab),r=e.getComponent(c.KpiTaskProgressItem);e.parent=this.kpiProgressContainers[t],e.position=cc.Vec3.ZERO,this._kpiProgressItems.push(r)}a.KpiScoreUpdateEvent.on(this.onKpiScoreUpdate,this),a.TaskUpdateEvent.on(this.onKpiTaskUpdate,this),a.LevelUpdateEvent.on(this.onLevelUp,this),a.ResetGameEvent.on(this.onResetGame,this)},e.prototype.onDestroy=function(){a.KpiScoreUpdateEvent.off(this.onKpiScoreUpdate,this),a.TaskUpdateEvent.off(this.onKpiTaskUpdate,this),a.LevelUpdateEvent.off(this.onLevelUp,this),a.ResetGameEvent.off(this.onResetGame,this)},e.prototype.onResetGame=function(){s.KPIManager.instance.resetKpiScore()},e.prototype.onEnable=function(){this.initRankLevel(),this.updateKpiTaskList();var t=s.KPIManager.instance.kpiScore;this.onKpiScoreUpdate(t)},e.prototype.initRankLevel=function(){var t=u.GlobalConfigMgr.Tables.GDLevel,e=s.KPIManager.instance.rankLevel,r=t.get(e);if(r){p.Utils.loadSpriteFrame(this.curRankLeveSprite,"card-up/badges/k"+r.res);var o=e+1,n=t.get(o);n?(this.nextRankLevelNode.active=!0,p.Utils.loadSpriteFrame(this.nextRankLevelIcon,"card-up/cards/k"+n.res)):this.nextRankLevelNode.active=!1}},e.prototype.onLevelUp=function(){for(var t=this,e=0;e<this._kpiProgressItems.length;e++)this._kpiProgressItems[e].onLevelUpEffect(.5,.3);var r=this.nextRankLevelIcon.node;cc.tween(r).to(.5,{y:200},{easing:"bounceOut"}).call(function(){t.initRankLevel(),t.updateKpiTaskList()}).to(.3,{y:0},{easing:"bounceOut"}).start()},e.prototype.updateKpiTaskList=function(){for(var t=s.KPIManager.instance.kpiList,e=0;e<this._kpiProgressItems.length;e++){var r=this._kpiProgressItems[e];if(e<t.length){var o=t[e];r.init(o)}else r.node.active=!1}},e.prototype.onKpiScoreUpdate=function(t){this.kpiScoreLbl.string="\xa5"+t,cc.tween(this.kpiScoreLbl.node).to(.2,{scale:1.2},{easing:"sineInOut"}).to(.1,{scale:1},{easing:"sineInOut"}).start()},e.prototype.onKpiTaskUpdate=function(){for(var t=0;t<this._kpiProgressItems.length;t++)this._kpiProgressItems[t].refresh()},e.prototype.onClickBoard=function(){l.UIManager.showUI("KpiTaskView",null)},e.prototype.onClickSettings=function(){l.UIManager.showUI("SettingsView",null)},i([f(cc.Label)],e.prototype,"kpiScoreLbl",void 0),i([f(cc.Node)],e.prototype,"kpiProgressContainers",void 0),i([f(cc.Prefab)],e.prototype,"kpiProgressItemPrefab",void 0),i([f(sp.Skeleton)],e.prototype,"rankLevelSkeleton",void 0),i([f(cc.Node)],e.prototype,"nextRankLevelNode",void 0),i([f(cc.Sprite)],e.prototype,"nextRankLevelIcon",void 0),i([f(cc.Sprite)],e.prototype,"curRankLeveSprite",void 0),i([d],e)}(cc.Component);r.KpiTaskBoard=g,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/UIManager":"UIManager","../common/Utils":"Utils","../event/EventBus":"EventBus","./KPIManager":"KPIManager","./KpiTaskProgressItem":"KpiTaskProgressItem"}],KpiTaskItem:[function(t,e,r){"use strict";cc._RF.push(e,"230b0/yATtNm7pnJecLP2UA","KpiTaskItem");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.KpiTaskItem=void 0;var a=t("./KPIManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.descTxt=null,e.processNode=null,e.processLabel=null,e.finishNode=null,e}return n(e,t),e.prototype.refresh=function(t){var e=a.KPIManager.instance.getKpiDesc(t);this.descTxt.string=e;var r=t.state===a.KpiState.Finish;this.processNode.active=!r,this.finishNode.active=r,r||(this.processLabel.string=t.curCount+"/"+t.conf.target1)},i([p(cc.RichText)],e.prototype,"descTxt",void 0),i([p(cc.Node)],e.prototype,"processNode",void 0),i([p(cc.Label)],e.prototype,"processLabel",void 0),i([p(cc.Node)],e.prototype,"finishNode",void 0),i([s],e)}(cc.Component);r.KpiTaskItem=u,cc._RF.pop()},{"./KPIManager":"KPIManager"}],KpiTaskProgressItem:[function(t,e,r){"use strict";cc._RF.push(e,"a17e9uu9d1Jbpnhk6hTHwmt","KpiTaskProgressItem");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.KpiTaskProgressItem=void 0;var a=t("./KPIManager"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.processNode=null,e.progressBar=null,e.finishNode=null,e._taskData=null,e.progressBarMaxWidth=92,e}return n(e,t),e.prototype.init=function(t){this._taskData=t,this.refresh()},e.prototype.refresh=function(){var t=this._taskData.state===a.KpiState.Finish;if(this.processNode.active=!t,this.finishNode.active=t,!t){var e=this._taskData.curCount/this._taskData.conf.target1;this.progressBar.node.width=Math.min(e,1)*this.progressBarMaxWidth}},e.prototype.onLevelUpEffect=function(t,e){cc.tween(this.node).to(t,{opacity:0}).to(e,{opacity:255}).start()},i([p(cc.Node)],e.prototype,"processNode",void 0),i([p(cc.Sprite)],e.prototype,"progressBar",void 0),i([p(cc.Node)],e.prototype,"finishNode",void 0),i([s],e)}(cc.Component);r.KpiTaskProgressItem=u,cc._RF.pop()},{"./KPIManager":"KPIManager"}],KpiTaskView:[function(t,e,r){"use strict";cc._RF.push(e,"964c6xO7EBFA6T5wlwS2KKH","KpiTaskView");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.KpiTaskView=void 0;var a=t("../common/BaseUI"),c=t("./KpiTaskItem"),s=t("./KPIManager"),p=cc._decorator,u=p.ccclass,l=p.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.taskContainers=[],e.taskItemPrefab=null,e.taskItems=[],e}return n(e,t),e.prototype.initData=function(e){t.prototype.initData.call(this,e);for(var r=s.KPIManager.instance.kpiList,o=0;o<this.taskContainers.length;o++){var n=this.taskContainers[o],i=cc.instantiate(this.taskItemPrefab),a=i.getComponent(c.KpiTaskItem);i.parent=n,i.position=cc.Vec3.ZERO,this.taskItems.push(a),o<r.length&&a.refresh(r[o])}},e.prototype.onCloseBtnClick=function(){this.close()},i([l(cc.Node)],e.prototype,"taskContainers",void 0),i([l(cc.Prefab)],e.prototype,"taskItemPrefab",void 0),i([u],e)}(a.BaseUI);r.KpiTaskView=h,cc._RF.pop()},{"../common/BaseUI":"BaseUI","./KPIManager":"KPIManager","./KpiTaskItem":"KpiTaskItem"}],LoadingScene:[function(t,e,r){"use strict";cc._RF.push(e,"0d2d1eZx3tOgYB5mvHaqLX8","LoadingScene");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},a=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,i){function a(t){try{s(o.next(t))}catch(e){i(e)}}function c(t){try{s(o.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(a,c)}s((o=o.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(t){return function(e){return s([t,e])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.LoadingScene=void 0;var s=t("../common/GlobalConfigMgr"),p=t("../common/SoundManager"),u=cc._decorator,l=u.ccclass,h=u.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.progressNode=null,e.progressLbl=null,e.progressFill=null,e.startBtn=null,e}return n(e,t),e.prototype.onLoad=function(){this.startLoading()},e.prototype.startLoading=function(){return a(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return this.startBtn.active=!1,this.progressLbl.string="\u52a0\u8f7d\u4e2d...",this.progressFill.width=0,[4,this.preloadConfig()];case 1:return t.sent(),this.progressFill.width=.2*this.progressNode.width,[4,this.preloadAssets()];case 2:return t.sent(),this.progressNode.active=!1,this.startBtn.active=!0,p.SoundManager.init(),[2]}})})},e.prototype.preloadAssets=function(){return a(this,void 0,void 0,function(){var t=this;return c(this,function(){return[2,new Promise(function(e){cc.director.preloadScene("main",function(e,r){t.progressLbl.string=Math.floor(e/r*100)+"%",t.progressFill.width=t.progressNode.width*(.2+e/r*.8)},function(){e()})})]})})},e.prototype.preloadConfig=function(){return s.GlobalConfigMgr.init()},e.prototype.onStartBtnClick=function(){cc.director.loadScene("main")},i([h(cc.Node)],e.prototype,"progressNode",void 0),i([h(cc.Label)],e.prototype,"progressLbl",void 0),i([h(cc.Node)],e.prototype,"progressFill",void 0),i([h(cc.Node)],e.prototype,"startBtn",void 0),i([l],e)}(cc.Component);r.LoadingScene=d,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/SoundManager":"SoundManager"}],LocalCache:[function(t,e,r){"use strict";cc._RF.push(e,"3b692DIl0FHrJ9jkywJDuFy","LocalCache"),Object.defineProperty(r,"__esModule",{value:!0}),r.LocalCache=r.LocalCacheKey=void 0,r.LocalCacheKey={snapshot:"snapshot",gameData:"gameData",historyData:"historyData",bgmMute:"bgmMute",sfxMute:"sfxMute",vibrationMute:"vibrationMute"};var o=function(){function t(){}return t.getItem=function(t,e){var r=cc.sys.localStorage.getItem(t);return void 0!==r?r:e},t.setItem=function(t,e){cc.sys.localStorage.setItem(t,e)},t.removeItem=function(t){cc.sys.localStorage.removeItem(t)},t.clear=function(){cc.sys.localStorage.clear()},t}();r.LocalCache=o,cc._RF.pop()},{}],MergeBoard:[function(t,e,r){"use strict";cc._RF.push(e,"db8beK2X1REZqTbAIBKz1j0","MergeBoard");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},a=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,i){function a(t){try{s(o.next(t))}catch(e){i(e)}}function c(t){try{s(o.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(a,c)}s((o=o.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(t){return function(e){return s([t,e])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(r,"__esModule",{value:!0}),r.MergeBoard=void 0;var s=t("./CardItem"),p=t("./CardBoardData"),u=t("./CardData"),l=t("../common/LocalCache"),h=t("./CardGroup"),d=t("./GridItem"),f=t("./MergeEffectToast"),g=t("../common/GlobalConfigMgr"),v=t("../common/SoundManager"),y=t("../kpi/KPIManager"),_=t("../event/EventBus"),C=cc._decorator,m=C.ccclass,b=C.property,M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.toastContainer=null,e.toastPrefab=null,e.gridContainer=null,e.gridPrefab=null,e.curCardsContainer=null,e.touchRect=null,e.rotationArrow=null,e.nextCardsContainer=null,e.cardGroupPrefab=null,e.cardPrefab=null,e.cardWidth=125,e.cardHeight=130,e.cardSpace=5,e._gridMatrix=[],e._curOption=null,e._nextOption=null,e._boardData=null,e._mergeResult=null,e._handleMergeGrids=[],e._cardPool=new cc.NodePool,e._touchStartPos=null,e._gridStartPos=null,e._optionStartPos=null,e._cardGridOffset=null,e._cardRelativePosList=[],e._cardCachePosList=[],e._hoveringGrids=[],e._curPosInMatrix=null,e._isTouching=!1,e._touchStartTime=0,e._draggingTimeThreshold=300,e._draggingDistanceThreshold=10,e.centerOffset=(u.GameConfig.matrixSize-1)/2,e}return n(e,t),e.prototype.onLoad=function(){v.SoundManager.playMusic("bgm"),this.createGrids(),this.loadBoard(),this.resetBoard(),this.touchRect.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touchRect.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touchRect.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchRect.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),_.ResetGameEvent.on(this.onResetGameClick,this)},e.prototype.onDestroy=function(){this.touchRect.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touchRect.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touchRect.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchRect.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),_.ResetGameEvent.off(this.onResetGameClick,this)},e.prototype.onResetGameClick=function(){this._boardData=new p.CardBoardData,this._boardData.resetBoard(),this.saveSnapshot(),this.resetBoard()},e.prototype.onTouchStart=function(t){if(!this._isTouching){var e=this._touchStartPos=t.getLocation();this.judgeTouchCurOption(e)&&(this._gridStartPos=this.gridContainer.convertToNodeSpaceAR(e),this._optionStartPos=this.curCardsContainer.convertToNodeSpaceAR(e),this._curOption.breathEffect(!1),this._isTouching=!0,this._touchStartTime=Date.now(),this._curPosInMatrix=cc.v3(this._gridStartPos.x,this._gridStartPos.y),this._cardRelativePosList=this._curOption.getCardPositions(),this._cardCachePosList=this._cardRelativePosList.map(function(t){return t.clone()}),this._cardGridOffset=this._curOption.getCardJudgeOffset())}},e.prototype.onTouchMove=function(t){if(this._isTouching){var e=t.getLocation().sub(this._touchStartPos);e.mag()<this._draggingDistanceThreshold||(this._curOption.node.x=this._optionStartPos.x+e.x,this._curOption.node.y=this._optionStartPos.y+e.y,this.updateTouchPosInMatrix(e),this.rotationArrow.active=!1,this.updateHoverGrids())}},e.prototype.onTouchEnd=function(t){if(this._isTouching){var e=t.getLocation().sub(this._touchStartPos),r=e.mag(),o=Date.now()-this._touchStartTime<this._draggingTimeThreshold,n=r<this._draggingDistanceThreshold;o&&n?(this.onTouchOption(),this._curOption.breathEffect(!0)):(this.updateTouchPosInMatrix(e),this.fillHoverGrids(),this.judgeCanPutCards()?(this.putCardsToGrids(),this.resetCurCardOption(!1)):this.resetCurCardOption(),this.refreshHoverGrids(null)),this.rotationArrow.active=!0,this._isTouching=!1}},e.prototype.putCardsToGrids=function(){v.SoundManager.playEffect("put_card");var t=this._hoveringGrids,e=this._curOption.getOptionData(),r=e.cards;(e.dir===u.CardDir.BottomToTop||e.dir===u.CardDir.RightToLeft)&&(r=r.reverse());for(var o=t.slice(),n=0;n<r.length;n++){var i=r[n],a=t[n],c=this.getCardItem();c.node.active=!0,c.node.setParent(this.gridContainer),c.node.position=a.node.position,c.refreshCard(i),a.updateCardItem(c);var s=a.getColRow();this._boardData.setCardData(s.col,s.row,i)}o.length>1&&o.sort(function(t,e){var r=t.getCardItem().getCardData(),o=e.getCardItem().getCardData();return r.level===o.level?r.isMajorCard?-1:1:r.level-o.level}),this._handleMergeGrids=o,this._mergeResult={operations:[],score:0},this.handleMergeCard(),this.produceOption()},e.prototype.handleMergeCard=function(){var t=this;if(console.log("\u5f00\u59cb\u5408\u6210\u5361\u7247",this._handleMergeGrids),0!==this._handleMergeGrids.length){var e=this._handleMergeGrids.shift();if(e&&e.getCardItem()){var r={parent:null,grid:e,depth:0},o={level:e.getCardItem().getCardData().level,mergeDataList:[r]};this._mergeResult.operations.push(o),this.collectMergeOperationInfoRecursively(o,[e],[r]).then(function(){console.log("\u672c\u6b21\u6536\u96c6\u5230\u7684\u7ed3\u679c\uff1a",o),o&&o.mergeDataList.length>=3?t.onExecuteMergeOperation(o,function(){t.handleMergeCard()}):t.handleMergeCard()})}else this.handleMergeCard()}else this.onHandleMergeFinish()},e.prototype.collectMergeOperationInfoRecursively=function(t,e,r){return a(this,void 0,void 0,function(){var o,n,i,a,s,p,u,l;return c(this,function(c){switch(c.label){case 0:if(0===r.length)return[2];for(o=t.level,n=[],i=0;i<r.length;i++)for(a=r[i],s=this.findCanMergeNeighbors(a,o),p=0;p<s.length;p++)u=s[p],e.includes(u)||(l={grid:u,parent:a,depth:a.depth+1},t.mergeDataList.push(l),n.push(l),e.push(u));return[4,this.collectMergeOperationInfoRecursively(t,e,n)];case 1:return c.sent(),[2]}})})},e.prototype.onExecuteMergeOperation=function(t,e){for(var r=this,o=t.mergeDataList,n=function(n){var a=o[n],c=a.grid.getColRow();if(!a.grid.getCardItem())return"continue";if(a.parent){console.log("\u5408\u6210\u679d\u5e72\u64cd\u4f5c, \u5f53\u524d\u5c42\u7ea7: "+a.depth+", \u5f53\u524d\u683c\u5b50: "+c.col+", "+c.row);var s=a.grid;if(s){var p=s.getCardItem();if(p){for(var u=[],l=a.parent;null!==l;)u.push(l.grid.node.position),l=l.parent;p.mergeEffect(u,function(){r._cardPool.put(p.node),s.updateCardItem(null);var t=s.getColRow();r._boardData.setCardData(t.col,t.row,null)})}}}else{console.log("\u5408\u6210\u6839\u8282\u70b9\u64cd\u4f5c, \u5f53\u524d\u683c\u5b50: "+c.col+", "+c.row);var h=t.level,d=o.length,v=g.GlobalConfigMgr.Tables.GDMergeResult.getDataList().find(function(t){return t.cId===h&&t.cardCount===d}),_=v.scoreRate*v.cId_ref.money*d;y.KPIManager.instance.addKpiScore(_);for(var C={},m=0;m<o.length;m++){var b=o[m].grid.getCardItem();if(b){var M=b.getCardData();C[M.color]||(C[M.color]=0),C[M.color]++}}for(var O in C){var P=C[O];P>1&&y.KPIManager.instance.addKpiMergeColorCount(parseInt(O),P)}y.KPIManager.instance.addKpiMergeLevelCount(h,d),y.KPIManager.instance.addKpiMultiMerge(h,d);var w=a.grid.getCardItem(),D=w.getCardData(),L=i._boardData.createCardForLevel(D,D.level+1);L?(L.isMajorCard=!0,i._handleMergeGrids.unshift(a.grid),w.levelUpEffect(L,function(){var t=L.level,o=function(){d>3?r.showToast(f.MergeEffectType.MergeCount,v.describe+"x"+d,e):e()};if(r._boardData.checkLvAboveMax(t)){var n=g.GlobalConfigMgr.Tables.GDCards.get(t);r.showToast(f.MergeEffectType.CardUp,"\u606d\u559c\u83b7\u53d6"+n.name+"\u7ea7\u4e8b\u9879\uff01",o)}else o()})):w.levelMaxEffect(function(){r._cardPool.put(w.node),a.grid.updateCardItem(null);var t=a.grid.getColRow();r._boardData.setCardData(t.col,t.row,null),r.showToast(f.MergeEffectType.CardMax,"\u5b8c\u6210\u4e8b\u9879\uff01",e),e()})}},i=this,a=o.length-1;a>=0;a--)n(a)},e.prototype.showToast=function(t,e,r){void 0===r&&(r=null);var o=cc.instantiate(this.toastPrefab);this.toastContainer.addChild(o),o.getComponent(f.MergeEffectToast).showToast(t,e,r)},e.prototype.onHandleMergeFinish=function(){if(this._boardData.checkMatrixFull());else{for(var t=0,e=0;e<this._mergeResult.operations.length;e++)this._mergeResult.operations[e].mergeDataList.length>=3&&t++;t>=2&&(this.showToast(f.MergeEffectType.Combo,"\u8fde\u7eed\u5b8c\u6210\u4e8b\u9879x"+t),y.KPIManager.instance.addKpiCombo(t)),this.saveSnapshot()}},e.prototype.saveSnapshot=function(){var t=this._boardData.getSnapshot();l.LocalCache.setItem(l.LocalCacheKey.snapshot,JSON.stringify(t))},e.prototype.onBoardFull=function(){},e.prototype.findCanMergeNeighbors=function(t,e){var r=this,o=t.grid.getColRow(),n=[],i=function(t,o){var i=r.getGridItemByColRow(t,o);i&&i.getCardItem()&&i.getCardItem().getCardData().level===e&&n.push(i)};return i(o.col-1,o.row),i(o.col+1,o.row),i(o.col,o.row-1),i(o.col,o.row+1),n},e.prototype.getGridItemByColRow=function(t,e){var r=this._gridMatrix;if(e<0||e>=r.length)return null;var o=r[e];return t<0||t>=o.length?null:o[t]},e.prototype.updateTouchPosInMatrix=function(t){this._curPosInMatrix.x=this._gridStartPos.x+t.x,this._curPosInMatrix.y=this._gridStartPos.y+t.y;for(var e=0;e<this._cardRelativePosList.length;e++){var r=this._cardRelativePosList[e];this._cardCachePosList[e].x=this._curPosInMatrix.x+r.x,this._cardCachePosList[e].y=this._curPosInMatrix.y+r.y}},e.prototype.judgeTouchCurOption=function(t){return this._curOption.node.getBoundingBoxToWorld().contains(t)},e.prototype.fillHoverGrids=function(){var t=this.getHoverGrids();this.refreshHoverGrids(t),this._hoveringGrids=t},e.prototype.refreshHoverGrids=function(t){if(this._hoveringGrids)for(var e=0;e<this._hoveringGrids.length;e++){var r=this._hoveringGrids[e];t&&t.includes(r)||r.changeHoverState(!1)}if(t)for(e=0;e<t.length;e++)r=t[e],this._hoveringGrids.includes(r)||r.changeHoverState(!0)},e.prototype.judgeCanPutCards=function(){return this._hoveringGrids.length===this._cardRelativePosList.length},e.prototype.getHoverGrids=function(){for(var t=this._curPosInMatrix,e=this.getGridColRow(t.x,t.y),r=e.row,o=e.col,n=u.GameConfig.matrixSize,i=this._cardGridOffset.col,a=this._cardGridOffset.row,c=Math.max(r-a,0),s=Math.min(r+a,n),p=Math.max(o-i,0),l=Math.min(o+i,n),h=[],d=c;d<s;d++)for(var f=p;f<l;f++){var g=this._gridMatrix[d][f];g.isHoldCard()||this.judgeGridInCardOption(g)&&h.push(g)}return h},e.prototype.judgeGridInCardOption=function(t){for(var e=this.cardWidth/2,r=this.cardHeight/2,o=t.node.position,n=0;n<this._cardCachePosList.length;n++){var i=this._cardCachePosList[n],a=i.x>=o.x-e&&i.x<=o.x+e,c=i.y>=o.y-r&&i.y<=o.y+r;if(a&&c)return!0}return!1},e.prototype.updateHoverGrids=function(){this.fillHoverGrids()},e.prototype.onTouchOption=function(){var t=this._curOption.rotateCards();-1!==t&&cc.tween(this.rotationArrow).by(.2,{angle:-90}).set({angle:-90*t}).start()},e.prototype.resetCurCardOption=function(t){var e=this;void 0===t&&(t=!0),t?cc.tween(this._curOption.node).to(.2,{position:cc.Vec3.ZERO}).call(function(){e._curOption.breathEffect(!0)}).start():(this._curOption.node.position=cc.Vec3.ZERO,this._curOption.breathEffect(!0))},e.prototype.produceOption=function(){this._boardData.generateNextCardOption();var t=this._boardData.getCurCardOption();t.cards.length>1&&(this.checkCurOptionCanPut()||(t=this._boardData.forceReplaceCurOptionToSingleCard())),this._curOption.refresh(t);var e=this._boardData.getNextCardOption();this._nextOption.refresh(e),this._curOption.breathEffect(!0),this.rotationArrow.angle=90},e.prototype.checkCurOptionCanPut=function(){for(var t=this._gridMatrix,e=0;e<t.length;e++)for(var r=t[e],o=0;o<r.length;o++)if(!r[o].getCardItem()){if(o+1<r.length&&!r[o+1].getCardItem())return!0;if(e+1<t.length&&!t[e+1][o].getCardItem())return!0}return!1},e.prototype.createGrids=function(){for(var t=u.GameConfig.matrixSize,e=0;e<t;e++){var r=[];this._gridMatrix.push(r);for(var o=0;o<t;o++){var n=cc.instantiate(this.gridPrefab);this.gridContainer.addChild(n);var i=this.getCardPos(e,o);n.setPosition(i);var a=n.getComponent(d.GridItem);a.init(o,e),r.push(a)}}},e.prototype.loadBoard=function(){var t=this._boardData=new p.CardBoardData,e=l.LocalCache.getItem(l.LocalCacheKey.snapshot,null);if(e){var r=JSON.parse(e);t.restoreSnapShot(r)}else t.resetBoard()},e.prototype.resetBoard=function(){for(var t=this._boardData.getCardMatrix(),e=this._gridMatrix,r=0;r<e.length;r++)for(var o=e[r],n=t[r],i=0;i<o.length;i++){var a=o[i],c=null==n?void 0:n[i],s=a.getCardItem();c?(s||((s=this.getCardItem()).node.parent=this.gridContainer),s.node.position=a.node.position,s.refreshCard(c),a.updateCardItem(s)):(s&&this._cardPool.put(s.node),a.updateCardItem(null))}this._curOption||(this._curOption=this.createCardOption(),this.curCardsContainer.addChild(this._curOption.node),this._curOption.refresh(this._boardData.getCurCardOption()),this._curOption.breathEffect(!0)),this._nextOption||(this._nextOption=this.createCardOption(),this.nextCardsContainer.addChild(this._nextOption.node),this._nextOption.refresh(this._boardData.getNextCardOption()))},e.prototype.createCardOption=function(){var t=cc.instantiate(this.cardGroupPrefab).getComponent(h.CardGroup);return t.init([this.getCardItem(),this.getCardItem()]),t},e.prototype.getCardItem=function(){return(this._cardPool.size()>0?this._cardPool.get():cc.instantiate(this.cardPrefab)).getComponent(s.CardItem)},e.prototype.getCardPos=function(t,e){var r=(e-this.centerOffset)*(this.cardWidth+this.cardSpace),o=(this.centerOffset-t)*(this.cardHeight+this.cardSpace);return cc.v3(r,o)},e.prototype.getGridColRow=function(t,e){var r=Math.round(t/(this.cardWidth+this.cardSpace)+this.centerOffset);return{row:Math.round(this.centerOffset-e/(this.cardHeight+this.cardSpace)),col:r}},i([b(cc.Node)],e.prototype,"toastContainer",void 0),i([b(cc.Prefab)],e.prototype,"toastPrefab",void 0),i([b(cc.Node)],e.prototype,"gridContainer",void 0),i([b(cc.Prefab)],e.prototype,"gridPrefab",void 0),i([b(cc.Node)],e.prototype,"curCardsContainer",void 0),i([b(cc.Node)],e.prototype,"touchRect",void 0),i([b(cc.Node)],e.prototype,"rotationArrow",void 0),i([b(cc.Node)],e.prototype,"nextCardsContainer",void 0),i([b(cc.Prefab)],e.prototype,"cardGroupPrefab",void 0),i([b(cc.Prefab)],e.prototype,"cardPrefab",void 0),i([m],e)}(cc.Component);r.MergeBoard=M,cc._RF.pop()},{"../common/GlobalConfigMgr":"GlobalConfigMgr","../common/LocalCache":"LocalCache","../common/SoundManager":"SoundManager","../event/EventBus":"EventBus","../kpi/KPIManager":"KPIManager","./CardBoardData":"CardBoardData","./CardData":"CardData","./CardGroup":"CardGroup","./CardItem":"CardItem","./GridItem":"GridItem","./MergeEffectToast":"MergeEffectToast"}],MergeEffectToast:[function(t,e,r){"use strict";cc._RF.push(e,"aa4a3WfTtFAo5B3EAqcIKni","MergeEffectToast");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.MergeEffectToast=r.MergeEffectType=void 0;var a=cc._decorator,c=a.ccclass,s=a.property;(function(t){t[t.MergeCount=0]="MergeCount",t[t.Combo=1]="Combo",t[t.CardUp=2]="CardUp",t[t.CardMax=3]="CardMax"})(r.MergeEffectType||(r.MergeEffectType={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aniNode=null,e.toastIcon=null,e.toastIconList=[],e.toastStr=null,e}return n(e,t),e.prototype.showToast=function(t,e,r){var o=this;this.toastIcon.spriteFrame=this.toastIconList[t],this.toastStr.string=e,cc.tween(this.aniNode).set({y:300,opacity:0}).to(.5,{y:0,opacity:255},{easing:"cubicInOut"}).delay(1).to(.2,{y:300,opacity:0},{easing:"cubicInOut"}).call(function(){o.node.destroy(),r&&r()}).start()},i([s(cc.Node)],e.prototype,"aniNode",void 0),i([s(cc.Sprite)],e.prototype,"toastIcon",void 0),i([s(cc.SpriteFrame)],e.prototype,"toastIconList",void 0),i([s(cc.Label)],e.prototype,"toastStr",void 0),i([c],e)}(cc.Component);r.MergeEffectToast=p,cc._RF.pop()},{}],PropBoard:[function(t,e,r){"use strict";cc._RF.push(e,"98147Lj2ShL84PDerYKt7x6","PropBoard");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.PropBoard=void 0;var a=t("./PropItem"),c=cc._decorator,s=c.ccclass,p=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normalNode=null,e.promptProp=null,e.bombProp=null,e.swapProp=null,e.usingPropNode=null,e}return n(e,t),e.prototype.onLoad=function(){this.changePropState(!1)},e.prototype.changePropState=function(t){this.normalNode.active=!t,this.usingPropNode.active=t},e.prototype.cancelProp=function(){this.changePropState(!1)},i([p(cc.Node)],e.prototype,"normalNode",void 0),i([p(a.PropItem)],e.prototype,"promptProp",void 0),i([p(a.PropItem)],e.prototype,"bombProp",void 0),i([p(a.PropItem)],e.prototype,"swapProp",void 0),i([p(cc.Node)],e.prototype,"usingPropNode",void 0),i([s],e)}(cc.Component);r.PropBoard=u,cc._RF.pop()},{"./PropItem":"PropItem"}],PropItem:[function(t,e,r){"use strict";cc._RF.push(e,"91a24Rh/ZNPKKKVi7423SPx","PropItem");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.PropItem=void 0;var a=t("../card-up/CardData"),c=cc._decorator,s=c.ccclass,p=c.property,u=cc.Enum(a.PropType),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.propType=a.PropType.Prompt,e}return n(e,t),e.prototype.onClickProp=function(){},i([p({type:u,tooltip:"\u9053\u5177\u7c7b\u578b"})],e.prototype,"propType",void 0),i([s],e)}(cc.Component);r.PropItem=l,cc._RF.pop()},{"../card-up/CardData":"CardData"}],SettingsView:[function(t,e,r){"use strict";cc._RF.push(e,"27b91SFuMVLEZ0yWs0ilFps","SettingsView");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.SettingsView=void 0;var a=t("../common/BaseUI"),c=t("../common/SoundManager"),s=t("../event/EventBus"),p=cc._decorator,u=p.ccclass,l=p.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgmToggle=null,e.sfxToggle=null,e.vibrationToggle=null,e}return n(e,t),e.prototype.initData=function(e){t.prototype.initData.call(this,e),this.bgmToggle.isChecked=c.SoundManager.bgmOpen,this.sfxToggle.isChecked=c.SoundManager.sfxOpen,this.vibrationToggle.isChecked=c.SoundManager.vibrationOpen},e.prototype.onCloseBtnClick=function(){this.close()},e.prototype.onBgmToggleChanged=function(){c.SoundManager.setBgmOpen(this.bgmToggle.isChecked),this.bgmToggle.isChecked?c.SoundManager.resumeMusic():c.SoundManager.pauseMusic()},e.prototype.onSfxToggleChanged=function(){c.SoundManager.setSfxOpen(this.sfxToggle.isChecked),this.sfxToggle.isChecked||c.SoundManager.stopEffect()},e.prototype.onVibrationToggleChanged=function(){c.SoundManager.setVibrationOpen(this.vibrationToggle.isChecked)},e.prototype.onResetGameBtnClick=function(){s.ResetGameEvent.emit(),this.close()},i([l(cc.Toggle)],e.prototype,"bgmToggle",void 0),i([l(cc.Toggle)],e.prototype,"sfxToggle",void 0),i([l(cc.Toggle)],e.prototype,"vibrationToggle",void 0),i([u],e)}(a.BaseUI);r.SettingsView=h,cc._RF.pop()},{"../common/BaseUI":"BaseUI","../common/SoundManager":"SoundManager","../event/EventBus":"EventBus"}],SoundManager:[function(t,e,r){"use strict";cc._RF.push(e,"9b67b3gmcNH0ZIgSmlUiAqS","SoundManager"),Object.defineProperty(r,"__esModule",{value:!0}),r.SoundManager=void 0;var o=t("./LocalCache"),n=function(){function t(){}return t.init=function(){this.bgmOpen=0==o.LocalCache.getItem(o.LocalCacheKey.bgmMute,0),this.sfxOpen=0==o.LocalCache.getItem(o.LocalCacheKey.sfxMute,0),this.vibrationOpen=0==o.LocalCache.getItem(o.LocalCacheKey.vibrationMute,0)},t.setBgmOpen=function(t){this.bgmOpen=t,o.LocalCache.setItem(o.LocalCacheKey.bgmMute,t?0:1)},t.setSfxOpen=function(t){this.sfxOpen=t,o.LocalCache.setItem(o.LocalCacheKey.sfxMute,t?0:1)},t.setVibrationOpen=function(t){this.vibrationOpen=t,o.LocalCache.setItem(o.LocalCacheKey.vibrationMute,t?0:1)},t.playEffect=function(t){if(this.sfxOpen){var e=this.soundPathPrefix+t;cc.resources.load(e,cc.AudioClip,function(t,e){t||cc.audioEngine.playEffect(e,!1)})}},t.playMusic=function(t){if(this.bgmOpen){var e=this.soundPathPrefix+t;cc.resources.load(e,cc.AudioClip,function(t,e){t||cc.audioEngine.playMusic(e,!0)})}else this._lastBgmName=t},t.stopMusic=function(){cc.audioEngine.stopMusic()},t.stopEffect=function(){cc.audioEngine.stopAllEffects()},t.resumeMusic=function(){this._lastBgmName?(this.playMusic(this._lastBgmName),this._lastBgmName=""):cc.audioEngine.resumeMusic()},t.pauseMusic=function(){cc.audioEngine.pauseMusic()},t.bgmOpen=!0,t.sfxOpen=!0,t.vibrationOpen=!0,t._lastBgmName="",t.soundPathPrefix="audio/",t}();r.SoundManager=n,cc._RF.pop()},{"./LocalCache":"LocalCache"}],TypedEvents:[function(t,e,r){"use strict";cc._RF.push(e,"3f0b3k6789OA7SFTH52pWd0","TypedEvents");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.createEventEmitter=r.TEvent=r.createEmitter=r.SealedEvent=r.BaseEvent=void 0;var i=function(){function t(){this.listeners=[]}return t.prototype.on=function(t,e){var r=this;if(!this.listeners.find(function(r){return t===r.callback&&e===r.target}))return this.listeners.push({target:e,once:!1,callback:t}),function(){r.off(t,e)};console.error("\u5df2\u7ecf\u5b58\u5728\u76f8\u540c\u7684\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570: "+t)},t.prototype.once=function(t,e){var r=this;if(!t){var o=new Promise(function(t){r.once(t)});return this.listeners[this.listeners.length-1].promise=o,o}this.listeners.push({target:e,once:!0,callback:t})},t.prototype.off=function(t,e){var r=this.listeners.length;return this.listeners=this.listeners.filter(function(r){return e!=r.target||t!==r.callback&&(!r.promise||t!==r.promise)}),this.listeners.length!==r},t.prototype.offAll=function(){var t=this.listeners.length;return this.listeners.length=0,t},t}();r.BaseEvent=i;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(i);function c(t){var e=t;function r(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var o=e.listeners,n=o.length>0,i=0,a=o;i<a.length;i++){var c=a[i];try{c.callback.apply(c.target,t)}catch(p){console.error("\u4e8b\u4ef6\u56de\u8c03\u6267\u884c\u51fa\u9519",p)}}for(var s=e.listeners.length-1;s>=0;s--)e.listeners[s].once&&e.listeners.splice(s,1);return n}var o=r;return o.event=t,o.emit=r,o}r.SealedEvent=a,r.createEmitter=function(){return c(new a)};var s=function(t){function e(){var e=t.call(this)||this;return e.emit=c(e),e}return n(e,t),e}(i);r.TEvent=s,r.createEventEmitter=function(){return c(new s)},cc._RF.pop()},{}],UIManager:[function(t,e,r){"use strict";cc._RF.push(e,"96ec0+Ed4FAy6d3NIU3hU0O","UIManager"),Object.defineProperty(r,"__esModule",{value:!0}),r.UIManager=void 0;var o=t("./BaseUI"),n=function(){function t(){}return t.showUI=function(t,e){cc.resources.load("prefabs/"+t,cc.Prefab,function(t,r){if(t)console.error(t);else{var n=cc.instantiate(r);cc.director.getScene().addChild(n);var i=n.getComponent(o.BaseUI);i&&i.show(e)}})},t}();r.UIManager=n,cc._RF.pop()},{"./BaseUI":"BaseUI"}],Utils:[function(t,e,r){"use strict";cc._RF.push(e,"63915WnfwhNNqLbG1rFORxU","Utils"),Object.defineProperty(r,"__esModule",{value:!0}),r.Utils=void 0;var o=function(){function t(){}return t.loadSpriteFrame=function(t,e){cc.resources.load(e,cc.SpriteFrame,function(e,r){e?cc.error(e):t&&cc.isValid(t)&&(t.spriteFrame=r)})},t}();r.Utils=o,cc._RF.pop()},{}],schema:[function(t,e,r){"use strict";var o;cc._RF.push(e,"95375QtqM5Jh7/Kk+Bb++SV","schema"),Object.defineProperty(r,"__esModule",{value:!0}),r.Tables=r.vector4=r.vector3=r.vector2=r.CardWeight=r.cfg=void 0,function(t){(function(t){t[t.None=0]="None",t[t.PassGuideStage=1]="PassGuideStage",t[t.Authorized=2]="Authorized",t[t.PassNewbieStage=4]="PassNewbieStage"})(t.EGuideType||(t.EGuideType={}))}(o=r.cfg||(r.cfg={})),function(t){(function(t){t[t.DressUp=1]="DressUp",t[t.Plank=2]="Plank"})(t.EItemType||(t.EItemType={}))}(o=r.cfg||(r.cfg={}));var n=function(){function t(t){if(void 0===t.key)throw new Error;if(this.key=t.key,void 0===t.weight)throw new Error;this.weight=t.weight}return t.prototype.resolve=function(t){this.key_ref=t.GDCards.get(this.key)},t}();r.CardWeight=n,function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.money)throw new Error;if(this.money=t.money,void 0===t.describe)throw new Error;this.describe=t.describe}return t.prototype.resolve=function(){},t}();t.GDCardData=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.cardCountWeight)throw new Error;this.cardCountWeight=[];for(var e=0,r=t.cardCountWeight;e<r.length;e++){var o=r[e],i=void 0;i=new n(o),this.cardCountWeight.push(i)}if(void 0===t.cardIdWeight)throw new Error;this.cardIdWeight=[];for(var a=0,c=t.cardIdWeight;a<c.length;a++)o=c[a],i=void 0,i=new n(o),this.cardIdWeight.push(i)}return t.prototype.resolve=function(t){for(var e=0,r=this.cardCountWeight;e<r.length;e++)null==(i=r[e])||i.resolve(t);for(var o=0,n=this.cardIdWeight;o<n.length;o++){var i;null==(i=n[o])||i.resolve(t)}},t}();t.GDCardGroupData=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.multi_rate)throw new Error;this.multiRate=[];for(var e=0,r=t.multi_rate;e<r.length;e++){var o;o=r[e],this.multiRate.push(o)}}return t.prototype.resolve=function(){},t}();t.GDCommonData=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.rank)throw new Error;if(this.rank=t.rank,void 0===t.target_type)throw new Error;if(this.targetType=t.target_type,void 0===t.target1)throw new Error;if(this.target1=t.target1,void 0===t.target2)throw new Error;this.target2=t.target2}return t.prototype.resolve=function(){},t}();t.GDKPIData=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.level)throw new Error;if(this.level=t.level,void 0===t.name)throw new Error;if(this.name=t.name,void 0===t.res)throw new Error;if(this.res=t.res,void 0===t.hex_color)throw new Error;if(this.hexColor=t.hex_color,void 0===t.describe)throw new Error;this.describe=t.describe}return t.prototype.resolve=function(){},t}();t.GDLevelData=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.level)throw new Error;if(this.level=t.level,void 0===t.groupWeight)throw new Error;this.groupWeight=[];for(var e=0,r=t.groupWeight;e<r.length;e++){var o,i=r[e];o=new n(i),this.groupWeight.push(o)}}return t.prototype.resolve=function(t){for(var e=0,r=this.groupWeight;e<r.length;e++){var o=r[e];null==o||o.resolve(t)}},t}();t.GDLevelGroupData=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function t(t){if(void 0===t.id)throw new Error;if(this.id=t.id,void 0===t.c_id)throw new Error;if(this.cId=t.c_id,void 0===t.card_count)throw new Error;if(this.cardCount=t.card_count,void 0===t.describe)throw new Error;if(this.describe=t.describe,void 0===t.score_rate)throw new Error;this.scoreRate=t.score_rate}return t.prototype.resolve=function(t){this.cId_ref=t.GDCards.get(this.cId)},t}();t.GDMergeResultData=e}(o=r.cfg||(r.cfg={}));var i=function(){function t(t){if(void 0===t.x)throw new Error;if(this.x=t.x,void 0===t.y)throw new Error;this.y=t.y}return t.prototype.resolve=function(){},t}();r.vector2=i;var a=function(){function t(t){if(void 0===t.x)throw new Error;if(this.x=t.x,void 0===t.y)throw new Error;if(this.y=t.y,void 0===t.z)throw new Error;this.z=t.z}return t.prototype.resolve=function(){},t}();r.vector3=a;var c=function(){function t(t){if(void 0===t.x)throw new Error;if(this.x=t.x,void 0===t.y)throw new Error;if(this.y=t.y,void 0===t.z)throw new Error;if(this.z=t.z,void 0===t.w)throw new Error;this.w=t.w}return t.prototype.resolve=function(){},t}();r.vector4=c,function(t){var e=function(){function e(e){if(1!=e.length)throw new Error("table mode=one, but size != 1");this._data=new t.GDCommonData(e[0])}return e.prototype.getData=function(){return this._data},Object.defineProperty(e.prototype,"multiRate",{get:function(){return this._data.multiRate},enumerable:!1,configurable:!0}),e.prototype.resolve=function(t){this._data.resolve(t)},e}();t.GDCommon=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var r=0,o=e;r<o.length;r++){var n,i=o[r];n=new t.GDCardData(i),this._dataList.push(n),this._dataMap.set(n.id,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,r=this._dataList;e<r.length;e++)r[e].resolve(t)},e}();t.GDCards=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var r=0,o=e;r<o.length;r++){var n,i=o[r];n=new t.GDCardGroupData(i),this._dataList.push(n),this._dataMap.set(n.id,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,r=this._dataList;e<r.length;e++)r[e].resolve(t)},e}();t.GDCardsGroup=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var r=0,o=e;r<o.length;r++){var n,i=o[r];n=new t.GDLevelGroupData(i),this._dataList.push(n),this._dataMap.set(n.level,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,r=this._dataList;e<r.length;e++)r[e].resolve(t)},e}();t.GDLevelGroup=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function e(e){this._dataList=[];for(var r=0,o=e;r<o.length;r++){var n,i=o[r];n=new t.GDMergeResultData(i),this._dataList.push(n)}}return e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataList[t]},e.prototype.resolve=function(t){for(var e=0,r=this._dataList;e<r.length;e++)r[e].resolve(t)},e}();t.GDMergeResult=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var r=0,o=e;r<o.length;r++){var n,i=o[r];n=new t.GDKPIData(i),this._dataList.push(n),this._dataMap.set(n.id,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,r=this._dataList;e<r.length;e++)r[e].resolve(t)},e}();t.GDKPI=e}(o=r.cfg||(r.cfg={})),function(t){var e=function(){function e(e){this._dataMap=new Map,this._dataList=[];for(var r=0,o=e;r<o.length;r++){var n,i=o[r];n=new t.GDLevelData(i),this._dataList.push(n),this._dataMap.set(n.level,n)}}return e.prototype.getDataMap=function(){return this._dataMap},e.prototype.getDataList=function(){return this._dataList},e.prototype.get=function(t){return this._dataMap.get(t)},e.prototype.resolve=function(t){for(var e=0,r=this._dataList;e<r.length;e++)r[e].resolve(t)},e}();t.GDLevel=e}(o=r.cfg||(r.cfg={}));var s=function(){function t(t){this._GDCommon=new o.GDCommon(t("cfg_gdcommon")),this._GDCards=new o.GDCards(t("cfg_gdcards")),this._GDCardsGroup=new o.GDCardsGroup(t("cfg_gdcardsgroup")),this._GDLevelGroup=new o.GDLevelGroup(t("cfg_gdlevelgroup")),this._GDMergeResult=new o.GDMergeResult(t("cfg_gdmergeresult")),this._GDKPI=new o.GDKPI(t("cfg_gdkpi")),this._GDLevel=new o.GDLevel(t("cfg_gdlevel")),this._GDCommon.resolve(this),this._GDCards.resolve(this),this._GDCardsGroup.resolve(this),this._GDLevelGroup.resolve(this),this._GDMergeResult.resolve(this),this._GDKPI.resolve(this),this._GDLevel.resolve(this)}return Object.defineProperty(t.prototype,"GDCommon",{get:function(){return this._GDCommon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDCards",{get:function(){return this._GDCards},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDCardsGroup",{get:function(){return this._GDCardsGroup},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDLevelGroup",{get:function(){return this._GDLevelGroup},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDMergeResult",{get:function(){return this._GDMergeResult},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDKPI",{get:function(){return this._GDKPI},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GDLevel",{get:function(){return this._GDLevel},enumerable:!1,configurable:!0}),t}();r.Tables=s,cc._RF.pop()},{}]},{},["CardBoardData","CardData","CardGroup","CardItem","CardOptionGenerator","GridItem","MergeBoard","MergeEffectToast","BaseUI","GlobalConfigMgr","LocalCache","SoundManager","TypedEvents","UIManager","Utils","schema","EventBus","KPIManager","KpiTaskBoard","KpiTaskItem","KpiTaskProgressItem","KpiTaskView","LoadingScene","PropBoard","PropItem","SettingsView"]);